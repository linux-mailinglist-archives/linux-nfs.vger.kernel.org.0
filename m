Return-Path: <linux-nfs-owner@vger.kernel.org>
X-Original-To: lists+linux-nfs@lfdr.de
Delivered-To: lists+linux-nfs@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 1104914BD28
	for <lists+linux-nfs@lfdr.de>; Tue, 28 Jan 2020 16:43:22 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726439AbgA1PnV (ORCPT <rfc822;lists+linux-nfs@lfdr.de>);
        Tue, 28 Jan 2020 10:43:21 -0500
Received: from mail-mw2nam12on2100.outbound.protection.outlook.com ([40.107.244.100]:43713
        "EHLO NAM12-MW2-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1726384AbgA1PnU (ORCPT <rfc822;linux-nfs@vger.kernel.org>);
        Tue, 28 Jan 2020 10:43:20 -0500
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=l8TphEYVaiYh1yLakiTt3eXdnM0F0PtJDXJVd5vlbv//cfI4xsXjM+V5i3hVGm11uiJJ3nIXEp7IndEzkSu3RxGufhXeQFNH0uYpceAI7aMJJWoRDLCWcZnc8SKoMM3xMVE1DPF0CJJnk1P/rNYQGLlCihDaQlw3sH739EXK1zBVHtxpEsiNTNdHfPPOQfMqVrO6kGw5xxt4RMSWmwe0NrOttI9achyT12IkoQqX+FrjicVpoOgo7CvCxyYuAr11xYiEEesvv+0/e5F7gMdZLt99ZdRH20EwUNjUF1dP0yvvrmROVlqfLbIhY7D00MGZ7VEZk1b+WhViXqJqBJq8wA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=Zj8cIg1sQ50r1H2DIXOetW4bk3iuSAwXT4bRhorbivw=;
 b=PjfwpKYMlPO8t3z7PT4LzLiSknyjVDxsO7OWCJA+iTmht6clzlvqFc3HSA0FK8asju1K0WEZpY/XfrjUk9Rli0EmiASSkZocMI19P2XlcRpkUhsRktna/wCLaVE1SgZwdQ/hXcOqhbO/rEhjX93dooK2+8skRFly5pMjsBIyeEFXv2ebvbMmzK8aUwonKYemI0XQNUSbun0WNMLOPpkJB7oh7DCtKCP291asfjHdGHIJ9rlYZHxN4SrbxJFroKQkNdk1o+7qu0HZcVw5ZB03XwIQsls2WPacO4/cfCwnxuV/xITvmcXq2PukHIpyaoxH1lWGziDreNEuEfXuer3Mrg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=hammerspace.com; dmarc=pass action=none
 header.from=hammerspace.com; dkim=pass header.d=hammerspace.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=hammerspace.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=Zj8cIg1sQ50r1H2DIXOetW4bk3iuSAwXT4bRhorbivw=;
 b=MgEXX3Tdp2rlp+MFydlD45xJNBLgU8VpYy4Wn6Y5qmgGBz/U3nUNaXofN38RdlKnCmUzA97Qw1o2hmv8Myl/acqWG5z8p1VVkLqQOezdU7HMvA/P1r/WvTpjvkWWJQR6U7F+EcyvWVZvOTMH3AZ90/d2NLIa/s4MK7Tq+kECc0I=
Received: from BN6PR1301MB2097.namprd13.prod.outlook.com (10.174.87.14) by
 BN6PR1301MB1889.namprd13.prod.outlook.com (10.174.89.20) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2686.15; Tue, 28 Jan 2020 15:43:15 +0000
Received: from BN6PR1301MB2097.namprd13.prod.outlook.com
 ([fe80::40e1:9ff5:2b8c:38bf]) by BN6PR1301MB2097.namprd13.prod.outlook.com
 ([fe80::40e1:9ff5:2b8c:38bf%5]) with mapi id 15.20.2686.019; Tue, 28 Jan 2020
 15:43:15 +0000
From:   Trond Myklebust <trondmy@hammerspace.com>
To:     "bcodding@redhat.com" <bcodding@redhat.com>,
        "Anna.Schumaker@netapp.com" <Anna.Schumaker@netapp.com>
CC:     "linux-nfs@vger.kernel.org" <linux-nfs@vger.kernel.org>
Subject: Re: [PATCH v2] NFS: Revalidate once when holding a delegation
Thread-Topic: [PATCH v2] NFS: Revalidate once when holding a delegation
Thread-Index: AQHV1e9om4L2YbskUEmxr8p6E5Q5GagAN22A
Date:   Tue, 28 Jan 2020 15:43:15 +0000
Message-ID: <6ff50ff0aa3c56cb6b1be67c35685e0e1fa9ece5.camel@hammerspace.com>
References: <bcb5ffd399c4434730e6d100a5b7cae5e207244e.1580225161.git.bcodding@redhat.com>
In-Reply-To: <bcb5ffd399c4434730e6d100a5b7cae5e207244e.1580225161.git.bcodding@redhat.com>
Accept-Language: en-US, en-GB
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=trondmy@hammerspace.com; 
x-originating-ip: [68.40.189.247]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: d5b9b443-30b0-41a2-aece-08d7a408ca03
x-ms-traffictypediagnostic: BN6PR1301MB1889:
x-microsoft-antispam-prvs: <BN6PR1301MB18899FDB29E84E078FA1C704B80A0@BN6PR1301MB1889.namprd13.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:9508;
x-forefront-prvs: 029651C7A1
x-forefront-antispam-report: SFV:NSPM;SFS:(10019020)(396003)(136003)(376002)(346002)(366004)(39830400003)(199004)(189003)(4326008)(76116006)(2906002)(36756003)(91956017)(81156014)(81166006)(478600001)(8936002)(8676002)(5660300002)(2616005)(86362001)(66446008)(110136005)(64756008)(316002)(66476007)(66946007)(66556008)(26005)(71200400001)(186003)(6506007)(6486002)(6512007);DIR:OUT;SFP:1102;SCL:1;SRVR:BN6PR1301MB1889;H:BN6PR1301MB2097.namprd13.prod.outlook.com;FPR:;SPF:None;LANG:en;PTR:InfoNoRecords;A:1;MX:1;
received-spf: None (protection.outlook.com: hammerspace.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: lQAcOdL+a8V8pFqD78tEVXzjmIwazlOvWRuaRBJ3ajXHktZGnXkq3yTvkgP9l9XRewnFjNYd/XnR8BupZQFjuBA+v7hf14JNRbWcJh9WJSen8oACS45oaP/a8ALP7JnBbgiO2VYOkZOBTLBm6uG9MEVSzblKjT+hNh7qzy1G6vo8FiohkCRKvqpFIXFjKsh4Ef4j9/xdE2C8D0DCMwQLJpH6MrY2k1x7pFd68iuwKFcZzffJmGBYUm1TbZOWjbwqwoToKpt50ExbbI35Rx9mK/9VW4HoL0OBWDvxCxoTzfvxS8WwCHGkVwwfvCwi2kfr3YqrTwh6VjL/17AY47tFIDN1ORm3uW+wyUCMxOe/eoMZuH9WHwzlTJZSK8hdkXnaHNUxMeZchVLa4PQWcC7khxPqGShIGbxRf8ChyvTxMehwk6V+3s9WWinPmmCp2vdZ
x-ms-exchange-antispam-messagedata: Efppw65hokd28GLUnUlnXvRQxLWi2RrQttCJlXRm20Ka3xhdO3Tcw3U2kJ9J5zE4krXivsrKXUmAczpX4SwcyrSixA9XV1d9fKab2cJDQDofHQV34DQITFpeaD7poV6PP5NyDpjHdi3VTaNG9wQ2BA==
x-ms-exchange-transport-forked: True
Content-Type: text/plain; charset="utf-8"
Content-ID: <9514A544AE992D46AC91C04ED5A93470@namprd13.prod.outlook.com>
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: hammerspace.com
X-MS-Exchange-CrossTenant-Network-Message-Id: d5b9b443-30b0-41a2-aece-08d7a408ca03
X-MS-Exchange-CrossTenant-originalarrivaltime: 28 Jan 2020 15:43:15.0737
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 0d4fed5c-3a70-46fe-9430-ece41741f59e
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: lmcvGAcOxXypn0aa3sK3T5RXTtWxOndl4dJXwO/thGRpdChn6HWHSwIKBLdgDvnlwAPgku9jvWYQwrg2rR9YQw==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN6PR1301MB1889
Sender: linux-nfs-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-nfs.vger.kernel.org>
X-Mailing-List: linux-nfs@vger.kernel.org

T24gVHVlLCAyMDIwLTAxLTI4IGF0IDEwOjI2IC0wNTAwLCBCZW5qYW1pbiBDb2RkaW5ndG9uIHdy
b3RlOg0KPiBJZiB3ZSBza2lwIGxvb2t1cCByZXZhbGlkYXRhaW9uIHdoaWxlIGhvbGRpbmcgYSBk
ZWxlZ2F0aW9uLCB3ZSBtaWdodA0KPiBtaXNzDQo+IHRoYXQgdGhlIGZpbGUgaGFzIGNoYW5nZWQg
ZGlyZWN0b3JpZXMgb24gdGhlIHNlcnZlci4gIFRoaXMgY2FuIGhhcHBlbg0KPiBpZg0KPiB0aGUg
ZmlsZSBpcyBtb3ZlZCBpbiBiZXR3ZWVuIHRoZSBjbGllbnQgY2FjaGluZyBhIGRlbnRyeSBhbmQN
Cj4gb2J0YWluaW5nIGENCj4gZGVsZWdhdGlvbi4gIFRoYXQgY2FuIGJlIHJlcHJvZHVjZWQgb24g
YSBzaW5nbGUgc3lzdGVtIHdpdGggdGhpcw0KPiBiYXNoOg0KPiANCj4gbWtkaXIgLXAgL2V4cG9y
dHMvZGlyezEsMn0NCj4gZXhwb3J0ZnMgLW8gcncgbG9jYWxob3N0Oi9leHBvcnRzDQo+IG1vdW50
IC10IG5mcyAtb3Y0LjEsbm9hYyBsb2NhbGhvc3Q6L2V4cG9ydHMgL21udC9sb2NhbGhvc3QNCj4g
DQo+IHRvdWNoIC9leHBvcnRzL2RpcjEvZnViYXINCj4gDQo+IGNhdCAvbW50L2xvY2FsaG9zdC9k
aXIxL2Z1YmFyDQo+IG12IC9tbnQvbG9jYWxob3N0L2RpcnsxLDJ9L2Z1YmFyDQo+IA0KPiBtdiAv
ZXhwb3J0cy9kaXJ7MiwxfS9mdWJhcg0KPiANCj4gY2F0IC9tbnQvbG9jYWxob3N0L2RpcjEvZnVi
YXINCj4gbXYgL21udC9sb2NhbGhvc3QvZGlyezEsMn0vZnViYXINCj4gDQo+IEluIHRoaXMgZXhh
bXBsZSwgdGhlIGZpbmFsIGBtdmAgd2lsbCBzdGF0IHNvdXJjZSBhbmQgZGVzdGluYXRpb24gYW5k
DQo+IGZpbmQNCj4gdGhleSBhcmUgdGhlIHNhbWUgZGVudHJ5Lg0KPiANCj4gVG8gZml4IHRoaXMg
d2l0aG91dCBnaXZpbmcgdXAgdGhlIGluY3JlYXNlZCBsb29rdXAgcGVyZm9ybWFuY2UgdGhhdA0K
PiBob2xkaW5nDQo+IGEgZGVsZWdhdGlvbiBwcm92aWRlcywgbGV0J3MgcmV2YWxpZGF0ZSB0aGUg
ZGVudHJ5IG9ubHkgb25jZSBhZnRlcg0KPiBvYnRhaW5pbmcgYSBkZWxlZ2F0aW9uIGJ5IHBsYWNp
bmcgYSBtYWdpYyB2YWx1ZSBpbiB0aGUgZGVudHJ5J3MNCj4gdmVyaWZpZXIuDQo+IA0KPiBTdWdn
ZXN0ZWQtYnk6IFRyb25kIE15a2xlYnVzdCA8dHJvbmQubXlrbGVidXN0QGhhbW1lcnNwYWNlLmNv
bT4NCj4gU2lnbmVkLW9mZi1ieTogQmVuamFtaW4gQ29kZGluZ3RvbiA8YmNvZGRpbmdAcmVkaGF0
LmNvbT4NCj4gLS0tDQo+ICBmcy9uZnMvZGlyLmMgfCAyMiArKysrKysrKysrKysrKysrKysrKy0t
DQo+ICAxIGZpbGUgY2hhbmdlZCwgMjAgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkNCj4g
DQo+IGRpZmYgLS1naXQgYS9mcy9uZnMvZGlyLmMgYi9mcy9uZnMvZGlyLmMNCj4gaW5kZXggZTE4
MDAzM2UzNWNmLi5lOWQwN2RjZDZkNmYgMTAwNjQ0DQo+IC0tLSBhL2ZzL25mcy9kaXIuYw0KPiAr
KysgYi9mcy9uZnMvZGlyLmMNCj4gQEAgLTk0OSw2ICs5NDksNyBAQCBzdGF0aWMgaW50IG5mc19m
c3luY19kaXIoc3RydWN0IGZpbGUgKmZpbHAsDQo+IGxvZmZfdCBzdGFydCwgbG9mZl90IGVuZCwN
Cj4gIAlyZXR1cm4gMDsNCj4gIH0NCj4gIA0KPiArI2RlZmluZSBORlNfREVMRUdBVElPTl9WRVJG
IDB4ZmVlZGRlYWYNCj4gIC8qKg0KPiAgICogbmZzX2ZvcmNlX2xvb2t1cF9yZXZhbGlkYXRlIC0g
TWFyayB0aGUgZGlyZWN0b3J5IGFzIGhhdmluZw0KPiBjaGFuZ2VkDQo+ICAgKiBAZGlyOiBwb2lu
dGVyIHRvIGRpcmVjdG9yeSBpbm9kZQ0KPiBAQCAtOTYyLDYgKzk2Myw4IEBAIHN0YXRpYyBpbnQg
bmZzX2ZzeW5jX2RpcihzdHJ1Y3QgZmlsZSAqZmlscCwNCj4gbG9mZl90IHN0YXJ0LCBsb2ZmX3Qg
ZW5kLA0KPiAgdm9pZCBuZnNfZm9yY2VfbG9va3VwX3JldmFsaWRhdGUoc3RydWN0IGlub2RlICpk
aXIpDQo+ICB7DQo+ICAJTkZTX0koZGlyKS0+Y2FjaGVfY2hhbmdlX2F0dHJpYnV0ZSsrOw0KPiAr
CWlmIChORlNfSShkaXIpLT5jYWNoZV9jaGFuZ2VfYXR0cmlidXRlID09IE5GU19ERUxFR0FUSU9O
X1ZFUkYpDQo+ICsJCU5GU19JKGRpciktPmNhY2hlX2NoYW5nZV9hdHRyaWJ1dGUrKzsNCj4gIH0N
Cj4gIEVYUE9SVF9TWU1CT0xfR1BMKG5mc19mb3JjZV9sb29rdXBfcmV2YWxpZGF0ZSk7DQo+ICAN
Cj4gQEAgLTExMzMsNiArMTEzNiw3IEBAIG5mc19sb29rdXBfcmV2YWxpZGF0ZV9kZW50cnkoc3Ry
dWN0IGlub2RlICpkaXIsDQo+IHN0cnVjdCBkZW50cnkgKmRlbnRyeSwNCj4gIAlzdHJ1Y3QgbmZz
X2ZoICpmaGFuZGxlOw0KPiAgCXN0cnVjdCBuZnNfZmF0dHIgKmZhdHRyOw0KPiAgCXN0cnVjdCBu
ZnM0X2xhYmVsICpsYWJlbDsNCj4gKwl1bnNpZ25lZCBsb25nIHZlcmlmaWVyOw0KPiAgCWludCBy
ZXQ7DQo+ICANCj4gIAlyZXQgPSAtRU5PTUVNOw0KPiBAQCAtMTE1NCw2ICsxMTU4LDExIEBAIG5m
c19sb29rdXBfcmV2YWxpZGF0ZV9kZW50cnkoc3RydWN0IGlub2RlDQo+ICpkaXIsIHN0cnVjdCBk
ZW50cnkgKmRlbnRyeSwNCj4gIAlpZiAobmZzX3JlZnJlc2hfaW5vZGUoaW5vZGUsIGZhdHRyKSA8
IDApDQo+ICAJCWdvdG8gb3V0Ow0KPiAgDQo+ICsJaWYgKE5GU19QUk9UTyhkaXIpLT5oYXZlX2Rl
bGVnYXRpb24oaW5vZGUsIEZNT0RFX1JFQUQpKQ0KPiArCQl2ZXJpZmllciA9IE5GU19ERUxFR0FU
SU9OX1ZFUkY7DQo+ICsJZWxzZQ0KPiArCQl2ZXJpZmllciA9IG5mc19zYXZlX2NoYW5nZV9hdHRy
aWJ1dGUoZGlyKTsNCj4gKw0KPiAgCW5mc19zZXRzZWN1cml0eShpbm9kZSwgZmF0dHIsIGxhYmVs
KTsNCj4gIAluZnNfc2V0X3ZlcmlmaWVyKGRlbnRyeSwgbmZzX3NhdmVfY2hhbmdlX2F0dHJpYnV0
ZShkaXIpKTsNCj4gIA0KPiBAQCAtMTE2Nyw2ICsxMTc2LDE1IEBAIG5mc19sb29rdXBfcmV2YWxp
ZGF0ZV9kZW50cnkoc3RydWN0IGlub2RlDQo+ICpkaXIsIHN0cnVjdCBkZW50cnkgKmRlbnRyeSwN
Cj4gIAlyZXR1cm4gbmZzX2xvb2t1cF9yZXZhbGlkYXRlX2RvbmUoZGlyLCBkZW50cnksIGlub2Rl
LCByZXQpOw0KPiAgfQ0KPiAgDQo+ICtzdGF0aWMgaW50IG5mc19kZWxlZ2F0aW9uX21hdGNoZXNf
ZGVudHJ5KHN0cnVjdCBpbm9kZSAqZGlyLA0KPiArCQkJc3RydWN0IGRlbnRyeSAqZGVudHJ5LCBz
dHJ1Y3QgaW5vZGUgKmlub2RlKQ0KPiArew0KPiArCWlmIChORlNfUFJPVE8oZGlyKS0+aGF2ZV9k
ZWxlZ2F0aW9uKGlub2RlLCBGTU9ERV9SRUFEKSAmJg0KPiArCQlkZW50cnktPmRfdGltZSA9PSBO
RlNfREVMRUdBVElPTl9WRVJGKQ0KPiArCQlyZXR1cm4gMTsNCj4gKwlyZXR1cm4gMDsNCj4gK30N
Cj4gKw0KPiAgLyoNCj4gICAqIFRoaXMgaXMgY2FsbGVkIGV2ZXJ5IHRpbWUgdGhlIGRjYWNoZSBo
YXMgYSBsb29rdXAgaGl0LA0KPiAgICogYW5kIHdlIHNob3VsZCBjaGVjayB3aGV0aGVyIHdlIGNh
biByZWFsbHkgdHJ1c3QgdGhhdA0KPiBAQCAtMTE5Nyw3ICsxMjE1LDcgQEAgbmZzX2RvX2xvb2t1
cF9yZXZhbGlkYXRlKHN0cnVjdCBpbm9kZSAqZGlyLA0KPiBzdHJ1Y3QgZGVudHJ5ICpkZW50cnks
DQo+ICAJCWdvdG8gb3V0X2JhZDsNCj4gIAl9DQo+ICANCj4gLQlpZiAoTkZTX1BST1RPKGRpcikt
PmhhdmVfZGVsZWdhdGlvbihpbm9kZSwgRk1PREVfUkVBRCkpDQo+ICsJaWYgKG5mc19kZWxlZ2F0
aW9uX21hdGNoZXNfZGVudHJ5KGRpciwgZGVudHJ5LCBpbm9kZSkpDQo+ICAJCXJldHVybiBuZnNf
bG9va3VwX3JldmFsaWRhdGVfZGVsZWdhdGVkKGRpciwgZGVudHJ5LA0KPiBpbm9kZSk7DQo+ICAN
Cj4gIAkvKiBGb3JjZSBhIGZ1bGwgbG9vayB1cCBpZmYgdGhlIHBhcmVudCBkaXJlY3RvcnkgaGFz
IGNoYW5nZWQgKi8NCj4gQEAgLTE2MzUsNyArMTY1Myw3IEBAIG5mczRfZG9fbG9va3VwX3JldmFs
aWRhdGUoc3RydWN0IGlub2RlICpkaXIsDQo+IHN0cnVjdCBkZW50cnkgKmRlbnRyeSwNCj4gIAlp
ZiAoaW5vZGUgPT0gTlVMTCkNCj4gIAkJZ290byBmdWxsX3JldmFsOw0KPiAgDQo+IC0JaWYgKE5G
U19QUk9UTyhkaXIpLT5oYXZlX2RlbGVnYXRpb24oaW5vZGUsIEZNT0RFX1JFQUQpKQ0KPiArCWlm
IChuZnNfZGVsZWdhdGlvbl9tYXRjaGVzX2RlbnRyeShkaXIsIGRlbnRyeSwgaW5vZGUpKQ0KPiAg
CQlyZXR1cm4gbmZzX2xvb2t1cF9yZXZhbGlkYXRlX2RlbGVnYXRlZChkaXIsIGRlbnRyeSwNCj4g
aW5vZGUpOw0KPiAgDQo+ICAJLyogTkZTIG9ubHkgc3VwcG9ydHMgT1BFTiBvbiByZWd1bGFyIGZp
bGVzICovDQoNClRoYW5rcyBCZW4hDQoNClJldmlld2VkLWJ5OiBUcm9uZCBNeWtsZWJ1c3QgPHRy
b25kLm15a2xlYnVzdEBoYW1tZXJzcGFjZS5jb20+DQoNCi0tIA0KVHJvbmQgTXlrbGVidXN0DQpM
aW51eCBORlMgY2xpZW50IG1haW50YWluZXIsIEhhbW1lcnNwYWNlDQp0cm9uZC5teWtsZWJ1c3RA
aGFtbWVyc3BhY2UuY29tDQoNCg0K
