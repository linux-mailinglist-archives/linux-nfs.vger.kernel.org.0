Return-Path: <linux-nfs-owner@vger.kernel.org>
X-Original-To: lists+linux-nfs@lfdr.de
Delivered-To: lists+linux-nfs@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id B991044D85D
	for <lists+linux-nfs@lfdr.de>; Thu, 11 Nov 2021 15:33:41 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S233454AbhKKOgY (ORCPT <rfc822;lists+linux-nfs@lfdr.de>);
        Thu, 11 Nov 2021 09:36:24 -0500
Received: from outgoing-stata.csail.mit.edu ([128.30.2.210]:58063 "EHLO
        outgoing-stata.csail.mit.edu" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S233466AbhKKOgX (ORCPT
        <rfc822;linux-nfs@vger.kernel.org>); Thu, 11 Nov 2021 09:36:23 -0500
Received: from c-24-60-30-97.hsd1.ct.comcast.net ([24.60.30.97] helo=crash.local)
        by outgoing-stata.csail.mit.edu with esmtpsa (TLS1.2:DHE_RSA_AES_256_CBC_SHA256:256)
        (Exim 4.82)
        (envelope-from <rtm@csail.mit.edu>)
        id 1mlB8t-000Mwg-7t; Thu, 11 Nov 2021 09:33:31 -0500
Received: from crash.local (localhost [127.0.0.1])
        by crash.local (Postfix) with ESMTP id AB6A612DE35AF;
        Thu, 11 Nov 2021 09:33:30 -0500 (EST)
To:     Trond Myklebust <trond.myklebust@hammerspace.com>,
        Anna Schumaker <anna.schumaker@netapp.com>
cc:     linux-nfs@vger.kernel.org
From:   rtm@csail.mit.edu
Reply-To: rtm@csail.mit.edu
Subject: an early NFS4ERR_MOVED causes client crash
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="=-=-="
Date:   Thu, 11 Nov 2021 09:33:30 -0500
Message-ID: <74993.1636641210@crash.local>
Precedence: bulk
List-ID: <linux-nfs.vger.kernel.org>
X-Mailing-List: linux-nfs@vger.kernel.org

--=-=-=
Content-Type: text/plain

do_nfs4_mount() issues a bunch of getattr RPCs before
server->super->s_root is set. If the server replies with an
NFS4ERR_MOVED during that time, nfs4_try_migration is called and
crashes when it tries to dereference s_root.

This problem exists on riscv kernel 5.15 and amd64 5.4.0. I've
attached a demo:

# cc nfs_12.c
# ./a.out
...
[   16.217793] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000030
[   16.219341] Oops [#1]
[   16.219811] Modules linked in:
[   16.220504] CPU: 0 PID: 70 Comm: 127.0.0.1-manag Not tainted 5.15.0-rc7-dirty #47
[   16.221715] Hardware name: ucbbar,riscvemu-bare (DT)
[   16.222491] epc : nfs4_try_migration+0x9e/0x13e
[   16.223367]  ra : nfs4_try_migration+0x90/0x13e
[   16.224234] epc : ffffffff8079a5f8 ra : ffffffff8079a5ea sp : ffffffd000593df0
...
[   16.236558] status: 0000000200000121 badaddr: 0000000000000030 cause: 000000000000000d
[   16.237694] [<ffffffff8079a5f8>] nfs4_try_migration+0x9e/0x13e
[   16.238743] [<ffffffff8023fcfe>] nfs4_run_state_manager+0x438/0x6aa
[   16.239804] [<ffffffff80025b60>] kthread+0xfe/0x110
[   16.240690] [<ffffffff80003054>] ret_from_exception+0x0/0xc


--=-=-=
Content-Type: application/octet-stream
Content-Disposition: attachment; filename=nfs_12.c
Content-Transfer-Encoding: base64

I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdHJpbmcuaD4KI2luY2x1ZGUgPHN0ZGxpYi5o
PgojaW5jbHVkZSA8dW5pc3RkLmg+CiNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CiNpbmNsdWRlIDxz
eXMvaW9jdGwuaD4KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KI2luY2x1ZGUgPHN5cy93YWl0Lmg+
CiNpbmNsdWRlIDxzeXMvcmVzb3VyY2UuaD4KI2luY2x1ZGUgPGFzc2VydC5oPgoKaW50IHN5bV9v
cCA9IDk7CmludCBzeW1fc2tpcCA9IDY7CmludCBzeW1fdHlwZSA9IDA7IC8vIGFsbCBmYXR0cjQg
ZmlsZSB0eXBlcwppbnQgc3ltX2ZoID0gMDsgLy8gYWxsIGZpbGUgaGFuZGxlcwoKaW50IG9wY291
bnRzWzI1Nl07CmxvbmcgbG9uZyBuZXh0X2Nvb2tpZSA9IDM7CmludCBjdXJyZW50X2ZoID0gMDsK
Ci8vIG1hcCBmaWxlL2RpciBuYW1lcyB0byBmaWxlIGhhbmRsZQpjaGFyICpmaG5hbWVzW10gPSB7
CiAgICAgICAgICAgICAgICIiLAogICAgICAgICAgICAgICAidG1wIiwKICAgICAgICAgICAgICAg
IngiLAogICAgICAgICAgICAgICAieSIsCiAgICAgICAgICAgICAgICJ6IiwKICAgICAgICAgICAg
ICAgInp6eiIsCiAgICAgICAgICAgICAgIDAKfTsKCmludApuYW1lMmZoKGNoYXIgKm5hbWUpCnsK
ICBmb3IoaW50IGkgPSAwOyBmaG5hbWVzW2ldOyBpKyspewogICAgaWYoc3RyY21wKG5hbWUsIGZo
bmFtZXNbaV0pID09IDApCiAgICAgIHJldHVybiBpOwogIH0KICByZXR1cm4gMTAwOwp9CgoKI2Rl
ZmluZSBOQUEgMTI4CnVuc2lnbmVkIGxvbmcgbG9uZyBhYVtOQUFdID0gewoweDIzMjcwMDAwdWxs
LAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGws
CjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwK
MHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAow
eDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4
MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgw
dWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1
bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVs
bCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxs
LAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGws
CjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwK
MHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAow
eDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4
MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgw
dWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1
bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVs
bCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxs
LAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGws
CjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCjB4MHVsbCwKMHgwdWxsLAoweDB1bGwsCn07CmludCBh
YWkgPSAwOwoKY2hhciBpYnVmWzQwOTZdOwppbnQgaWxlbiA9IDA7CmludCBpaSA9IDA7CmNoYXIg
b2J1Zls0MDk2XTsKaW50IG9pID0gMDsKaW50IHN5bXN0YXJ0ID0gLTE7CmludCBzeW1lbmQgPSAt
MTsKCmludCByZWFkbihpbnQgZmQsIHZvaWQgKnhidWYsIGludCBuKSB7CiAgY2hhciAqYnVmID0g
KGNoYXIgKikgeGJ1ZjsKICBpbnQgb3JpZyA9IG47CiAgd2hpbGUobiA+IDApewogICAgaW50IGNj
ID0gcmVhZChmZCwgYnVmLCBuKTsKICAgIGlmKGNjIDw9IDApIHsgcGVycm9yKCJyZWFkIik7IHJl
dHVybiAtMTsgfQogICAgbiAtPSBjYzsKICAgIGJ1ZiArPSBjYzsKICB9CiAgcmV0dXJuIG9yaWc7
Cn0KCnVuc2lnbmVkIGludApwYXJzZTMyKCkKewogIGlmKGlpID49IGlsZW4pewogICAgcHJpbnRm
KCJwYXJzZWQgYmV5b25kIHRoZSBlbmQgb2YgdGhlIGlucHV0XG4iKTsKICAgIHJldHVybiAwOwog
IH0KICB1bnNpZ25lZCBpbnQgeCA9ICooaW50KikoaWJ1ZitpaSk7CiAgaWkgKz0gNDsKICByZXR1
cm4gbnRvaGwoeCk7Cn0KCnVuc2lnbmVkIGxvbmcgbG9uZwpwYXJzZTY0KCkKewogIHVuc2lnbmVk
IGxvbmcgbG9uZyBoaSA9IHBhcnNlMzIoKTsKICB1bnNpZ25lZCBsb25nIGxvbmcgbG8gPSBwYXJz
ZTMyKCk7CiAgcmV0dXJuIChoaSA8PCAzMikgfCBsbzsKfQoKLy8gc2Vzc2lvbmlkNCAtLSAxNiBi
eXRlcwp2b2lkCnBhcnNlX3NpZChjaGFyICpzaWQpCnsKICBmb3IoaW50IGkgPSAwOyBpIDwgMTY7
IGkrKyl7CiAgICBpZihzaWQpCiAgICAgIHNpZFtpXSA9IGlidWZbaWldOwogICAgaWkrKzsKICB9
Cn0KCnVuc2lnbmVkIGludApwYXJzZV9vcGFxdWUoY2hhciAqYnVmKQp7CiAgaWYoYnVmKQogICAg
YnVmWzBdID0gMDsKICBpbnQgbm9taW5hbF9uID0gcGFyc2UzMigpOwogIGlmKG5vbWluYWxfbiA+
IDQwOTYpewogICAgcHJpbnRmKCJjcmF6eSBvcGFxdWUgbGVuZ3RoICVkXG4iLCBub21pbmFsX24p
OwogICAgcmV0dXJuIDA7CiAgfQogIGludCByZWFsX24gPSBub21pbmFsX247CiAgd2hpbGUoKHJl
YWxfbiU0KSAhPSAwKSByZWFsX24gKz0gMTsKICBmb3IoaW50IGkgPSAwOyBpIDwgcmVhbF9uOyBp
KyspewogICAgaWYoYnVmICYmIGkgPCByZWFsX24pCiAgICAgIGJ1ZltpXSA9IGlidWZbaWldOwog
ICAgaWkrKzsKICB9CiAgcmV0dXJuIG5vbWluYWxfbjsKfQoKdm9pZApwdXQzMih1bnNpZ25lZCBp
bnQgeCkKewogIGFzc2VydCgob2kgJSA0KSA9PSAwKTsKICAqKGludCopKG9idWYrb2kpID0gaHRv
bmwoeCk7CiAgb2kgKz0gNDsKfQoKdm9pZApwdXQ2NCh1bnNpZ25lZCBsb25nIGxvbmcgeCkKewog
IHB1dDMyKHggPj4gMzIpOwogIHB1dDMyKHgpOwp9Cgp2b2lkCnB1dF9vcGFxdWUoaW50IG4sIGNo
YXIgKmJ1ZikKewogIHB1dDMyKG4pOwogIGZvcihpbnQgaSA9IDA7IGkgPCBuOyBpKyspCiAgICBv
YnVmW29pKytdID0gKGJ1ZiA/IGJ1ZltpXSA6IDApOwogIHdoaWxlKChuJTQpIT0wKXsKICAgIG9i
dWZbb2krK10gPSAwOwogICAgbisrOwogIH0KfQoKdm9pZApwdXRfc2lkKGNoYXIgKnNpZCkKewog
IGZvcihpbnQgaSA9IDA7IGkgPCAxNjsgaSsrKXsKICAgIG9idWZbb2krK10gPSAoc2lkID8gc2lk
W2ldIDogMCk7CiAgfQp9Cgp2b2lkCnBhcnNlX25vcCgpCnsKfQoKdm9pZApwYXJzZV9vcF9leGNo
YW5nZV9pZCgpCnsKICBwYXJzZTMyKCk7IC8vIHZlcmlmaWVyNCwgZmlyc3QgaGFsZgogIHBhcnNl
MzIoKTsgLy8gdmVyaWZpZXI0LCBzZWNvbmQgaGFsZgogIHBhcnNlX29wYXF1ZSgwKTsgLy8gZWlh
X2NsaWVudG93bmVyCiAgaW50IGNmbGFncyA9IHBhcnNlMzIoKTsgLy8gZWlhX2ZsYWdzCiAgcGFy
c2UzMigpOyAvLyBzdGF0ZV9wcm90ZWN0NF9hLnNwYV9ob3csIGFzc3VtZSBTUDRfTk9ORQogIGlu
dCBuaW1wbCA9IHBhcnNlMzIoKTsgLy8gbGVuZ3RoIG9mIGNsaWVudF9pbXBsX2lkCiAgZm9yKGlu
dCBpbXBsaSA9IDA7IGltcGxpIDwgbmltcGw7IGltcGxpKyspewogICAgY2hhciBqdW5rWzUxMl07
CiAgICBwYXJzZV9vcGFxdWUoanVuayk7IC8vIG5paV9kb21haW4KICAgIC8vIHByaW50Zigibmlp
X2RvbWFpbjogJXNcbiIsIGp1bmspOwogICAgcGFyc2Vfb3BhcXVlKGp1bmspOyAvLyBuaWlfbmFt
ZQogICAgLy8gcHJpbnRmKCJuaWlfbmFtZTogJXNcbiIsIGp1bmspOwogICAgcGFyc2U2NCgpOyAv
LyAxLzIgb2YgbmZzdGltZTQKICAgIHBhcnNlMzIoKTsgLy8gMS8yIG9mIG5mc3RpbWU0CiAgfQoK
ICAvLyBmaW5pc2ggRVhDSEFOR0VfSUQ0cmVzCiAgcHV0MzIoMCk7IC8vIGVpcl9zdGF0dXMgPSBO
RlM0X09LCiAgcHV0NjQoMSk7IC8vIGNsaWVudGlkNAogIHB1dDMyKDEpOyAvLyBzZXF1ZW5jZWlk
NAogIGludCBzZmxhZ3MgPSAweDEwMyB8IDB4MTAwMDA7IC8vIEVYQ0hHSUQ0X0ZMQUdfVVNFX05P
Tl9QTkZTCiAgcHV0MzIoc2ZsYWdzKTsgLy8gZWlyX2ZsYWdzCiAgcHV0MzIoMCk7IC8vIHN0YXRl
X3Byb3RlY3Q0X3Iuc3ByX2hvdyA9IFNQNF9OT05FCiAgcHV0NjQoMSk7IC8vIHNlcnZlcl9vd25l
cjQuc29fbWlub3JfaWQKICBwdXQzMig0KTsgLy8gbGVuZ3RoIG9mIHNvX21ham9yX2lkPD4KICBw
dXQzMigweDExMjIzMzQ0KTsgLy8gc29fbWFqb3JfaWQ8PgogIHB1dDMyKDQpOyAvLyBsZW5ndGgg
b2YgZWlyX3NlcnZlcl9zY29wZQogIHB1dDMyKDB4MTEyMjMzNDQpOwogIHB1dDMyKDEpOyAvLyBs
ZW5ndGggb2YgZWlyX3NlcnZlcl9pbXBsX2lkPDE+CiAgcHV0MzIoNCk7IC8vIG5mc19pbXBsX2lk
NC5uaWlfZG9tYWluCiAgcHV0MzIoMHgxMTIyMzM0NCk7CiAgcHV0MzIoNCk7IC8vIG5mc19pbXBs
X2lkNC5uaWlfbmFtZQogIHB1dDMyKDB4MTEyMjMzNDQpOwogIHB1dDY0KDApOyAvLyBuaWlfZGF0
ZSAxLzIKICBwdXQzMigwKTsgLy8gbmlpX2RhdGUgMi8yCn0KCnZvaWQKcGFyc2Vfb3BfY3JlYXRl
X3Nlc3Npb24oKQp7CiAgcGFyc2U2NCgpOyAvLyBjc2FfY2xpZW50aWQKICBpbnQgc2VxID0gcGFy
c2UzMigpOyAvLyBjc2Ffc2VxdWVuY2UKICBwYXJzZTMyKCk7IC8vIGNzYV9mbGFncwogIC8vIGNz
YV9mb3JlX2NoYW5fYXR0cnMsIGNzYV9iYWNrX2NoYW5fYXR0cnMKICBpbnQgYXR0cnNbMl1bNl07
CiAgZm9yKGludCBpID0gMDsgaSA8IDI7IGkrKyl7CiAgICBmb3IoaW50IGogPSAwOyBqIDwgNjsg
aisrKXsKICAgICAgYXR0cnNbaV1bal0gPSBwYXJzZTMyKCk7CiAgICB9CiAgICBwYXJzZV9vcGFx
dWUoMCk7IC8vIGNhX3JkbWFfaXJkPDE+CiAgfQoKICBwdXQzMigwKTsgLy8gT0sKICBmb3IoaW50
IGkgPSAwOyBpIDwgNDsgaSsrKQogICAgcHV0MzIoMSk7IC8vIGNzcl9zZXNzaW9uaWQgaS80CiAg
cHV0MzIoc2VxKTsgLy8gY3NyX3NlcXVlbmNlCiAgcHV0MzIoMHgzKTsgLy8gY3NyX2ZsYWdzCgog
IGZvcihpbnQgaSA9IDA7IGkgPCAyOyBpKyspewogICAgZm9yKGludCBqID0gMDsgaiA8IDY7IGor
KykKICAgICAgcHV0MzIoYXR0cnNbaV1bal0pOwogICAgcHV0MzIoMCk7IC8vIGNhX3JkbWFfaXJk
CiAgfQp9Cgp2b2lkCnBhcnNlX29wX3NlcXVlbmNlKCkKewogIGNoYXIgc2lkWzE2XTsKCiAgcGFy
c2Vfc2lkKHNpZCk7IC8vIHNhX3Nlc3Npb25pZAogIGludCBzZXEgPSBwYXJzZTMyKCk7IC8vIHNh
X3NlcXVlbmNlaWQKICBpbnQgc2xvdCA9IHBhcnNlMzIoKTsgLy8gc2Ffc2xvdGlkCiAgaW50IGhp
c2xvdCA9IHBhcnNlMzIoKTsgLy8gc2FfaGlnaGVzdF9zbG90aWQKICBwYXJzZTMyKCk7IC8vIHNh
X2NhY2hldGhpcwoKICBwdXQzMigwKTsgLy8gT0sKICBwdXRfc2lkKHNpZCk7IC8vIHNyX3Nlc3Np
b25pZAogIHB1dDMyKHNlcSk7IC8vIHNyX3NlcXVlbmNlaWQKICBwdXQzMihzbG90KTsgLy8gc3Jf
c2xvdGlkCiAgcHV0MzIoaGlzbG90KTsgLy8gc3JfaGlnaGVzdF9zbG90aWQKICBwdXQzMihoaXNs
b3QpOyAvLyBzcl90YXJnZXRfaGlnaGVzdF9zbG90aWQKICBwdXQzMigwKTsgLy8gc3Jfc3RhdHVz
X2ZsYWdzCn0KCnZvaWQKcGFyc2Vfb3BfcmVjbGFpbV9jb21wbGV0ZSgpCnsKICBwYXJzZTMyKCk7
IC8vIHJjYV9vbmVfZnMKICBwdXQzMigwKTsgLy8gcmNyX3N0YXR1cwp9Cgp2b2lkCnBhcnNlX29w
X3B1dHJvb3RmaCgpCnsKICAvLyBubyBhcmd1bWVudHMKICBwdXQzMigwKTsgLy8gT0sKICBjdXJy
ZW50X2ZoID0gMDsKfQoKdm9pZApwYXJzZV9vcF9zZWNpbmZvX25vX25hbWUoKQp7CiAgcGFyc2Uz
MigpOyAvLyBzZWNpbmZvX3N0eWxlNAogIHB1dDMyKDApOyAvLyBPSwogIHB1dDMyKDEpOyAvLyAj
IG9mIHNlY2luZm80CiNpZiAxCiAgcHV0MzIoMCk7IC8vIGZsYXZvciA9IEFVVEhfTlVMTAojZWxz
ZQogIHB1dDMyKDYpOyAvLyBmbGF2b3IgPSBSUENTRUNfR1NTCiAgcHV0MzIoNCk7IC8vIHNpemUg
b2Ygc2VjX29pZDQKICBwdXQzMigweGZmZmZmZmZmKTsKICBwdXQzMigwKTsgLy8gcW9wNAogIHB1
dDMyKDEpOyAvLyBycGNfZ3NzX3N2Y190CiNlbmRpZgp9Cgp2b2lkCnBhcnNlX29wX2Rlc3Ryb3lf
c2Vzc2lvbigpCnsKICBwYXJzZV9zaWQoMCk7CiAgcHV0MzIoMCk7IC8vIE9LCn0KCnZvaWQKcGFy
c2Vfb3BfZGVzdHJveV9jbGllbnRpZCgpCnsKICBwYXJzZTY0KCk7IC8vIGNsaWVudGlkCiAgcHV0
MzIoMCk7IC8vIE9LCn0KCnZvaWQKcGFyc2Vfb3BfZ2V0ZmgoKQp7CiAgLy8gbm8gYXJndW1lbnRz
CiAgcHV0MzIoMCk7IC8vIE9LCiAgaW50IHhmaCA9IGN1cnJlbnRfZmg7CiAgaWYoc3ltX2ZoKSB4
ZmggXj0gYWFbYWFpKytdOwogIHB1dF9vcGFxdWUoNCwgKGNoYXIqKSZ4ZmgpOyAvLyBmaAp9Cgov
LwovLyBjYWxsZWQgYnkgZ2V0YXR0ciBhbmQgcmVhZGRpci4KLy8gZ2VuZXJhdGVzIGEgZmF0dHI0
IChiaXRtYXA0IHRoZW4gYXR0cmxpc3Q0KS4KLy8Kdm9pZApwdXRfZmF0dHI0KGludCBiaXR3b3Jk
cywgaW50IHdvcmRzW10sIGludCBmaCkKewppZihzeW1zdGFydCA+IDApIHByaW50ZigiYml0d29y
ZHM9JWQgQCAlZFxuIiwgYml0d29yZHMsIG9pKTsKICBwdXQzMihiaXR3b3Jkcyk7CiAgZm9yKGlu
dCBpID0gMDsgaSA8IGJpdHdvcmRzOyBpKyspCiAgICBwdXQzMih3b3Jkc1tpXSk7CiAgaW50IGxl
bmkgPSBvaTsKICBwdXQzMigwKTsgLy8gcGxhY2Vob2xkZXIgZm9yIHRvdGFsIGxlbmd0aCBvZiBh
dHRycwogIGZvcihpbnQgYSA9IDA7IGEgPCBiaXR3b3JkcyozMjsgYSsrKXsKICAgIGlmKHdvcmRz
W2EvMzJdICYgKDEgPDwgKGEgJSAzMikpKXsKaWYoc3ltc3RhcnQgPiAwKSBwcmludGYoImE9JWQg
QCAlZFxuIiwgYSwgb2kpOwogICAgICBpZihhID09IDApewogICAgICAgIHB1dDMyKDIpOyAvLyAj
IGJpdG1hcCB3b3JkcyBvZiBzdXBwb3J0ZWQgYXR0cnMKICAgICAgICBwdXQzMigweGZmZmZmZmZm
KTsKICAgICAgICBwdXQzMigweGZmZmZmZmZmKTsKICAgICAgfSBlbHNlIGlmKGEgPT0gMSl7CiAg
ICAgICAgaW50IHR5cGUgPSAxOwogICAgICAgIGlmKGZoID09IDAgfHwgZmggPT0gMSkKICAgICAg
ICAgIHR5cGUgPSAyOwogICAgICAgIGlmKHN5bV90eXBlKSB0eXBlIF49IGFhW2FhaSsrXTsKICAg
ICAgICBwdXQzMih0eXBlKTsgLy8gTkY0RElSPTIgb3IgTkY0UkVHPTEKICAgICAgfSBlbHNlIGlm
KGEgPT0gMil7CiAgICAgICAgcHV0MzIoMCk7IC8vIGZoX2V4cGlyZV90eXBlCiAgICAgIH0gZWxz
ZSBpZihhID09IDMpewogICAgICAgIHB1dDY0KDApOyAvLyBjaGFuZ2UKICAgICAgfSBlbHNlIGlm
KGEgPT0gNCl7CiAgICAgICAgcHV0NjQoNDA5NioxMCk7IC8vIHNpemUKICAgICAgfSBlbHNlIGlm
KGEgPT0gNSl7CiAgICAgICAgcHV0MzIoMSk7IC8vIGxpbmsgc3VwcG9ydAogICAgICB9IGVsc2Ug
aWYoYSA9PSA2KXsKICAgICAgICBwdXQzMigxKTsgLy8gc3ltbGluayBzdXBwb3J0CiAgICAgIH0g
ZWxzZSBpZihhID09IDgpewogICAgICAgIHB1dDY0KDEpOyAvLyBmc2lkIG1ham9yCiAgICAgICAg
cHV0NjQoMSk7IC8vIGZzaWQgbWlub3IKICAgICAgfSBlbHNlIGlmKGEgPT0gMTApewogICAgICAg
IHB1dDMyKDEpOyAvLyBsZWFzZSB0aW1lCiAgICAgIH0gZWxzZSBpZihhID09IDExKXsKICAgICAg
ICBwdXQzMigwKTsgLy8gcmRhdHRyX2Vycm9yCiAgICAgIH0gZWxzZSBpZihhID09IDEzKXsKICAg
ICAgICBwdXQzMigweGYpOyAvLyBhY2xzdXBwb3J0CiAgICAgIH0gZWxzZSBpZihhID09IDE5KXsK
ICAgICAgICAvLyBmaWxlaGFuZGxlCiAgICAgICAgaW50IHhmaCA9IGZoOwogICAgICAgIGlmKHN5
bV9maCkgeGZoIF49IGFhW2FhaSsrXTsKICAgICAgICBwdXRfb3BhcXVlKDQsIChjaGFyKikmeGZo
KTsgLy8gZmgKICAgICAgfSBlbHNlIGlmKGEgPT0gMjApewogICAgICAgIHB1dDY0KGZoKTsgLy8g
ZmlsZWlkCiAgICAgIH0gZWxzZSBpZihhID09IDI3KXsKICAgICAgICBwdXQ2NCgweGZmZmZmZmZm
ZmZmZik7IC8vIG1heCBmaWxlIHNpemUKICAgICAgfSBlbHNlIGlmKGEgPT0gMjgpewogICAgICAg
IHB1dDMyKDB4ZmZmZik7IC8vIG1heCBsaW5rCiAgICAgIH0gZWxzZSBpZihhID09IDI5KXsKICAg
ICAgICBwdXQzMigyNTYpOyAvLyBtYXggbmFtZQogICAgICB9IGVsc2UgaWYoYSA9PSAzMCl7CiAg
ICAgICAgcHV0NjQoMTAqNDA5Nik7IC8vIG1heCByZWFkCiAgICAgIH0gZWxzZSBpZihhID09IDMx
KXsKICAgICAgICBwdXQ2NCgxMCo0MDk2KTsgLy8gbWF4IHdyaXRlCiAgICAgIH0gZWxzZSBpZihh
ID09IDMzKXsKICAgICAgICBwdXQzMigwNzc3KTsgLy8gbW9kZQogICAgICB9IGVsc2UgaWYoYSA9
PSAzNSl7CiAgICAgICAgcHV0MzIoMyk7IC8vIG51bWxpbmtzCiAgICAgIH0gZWxzZSBpZihhID09
IDM2KXsKICAgICAgICBwdXRfb3BhcXVlKDYsICJvdGhlciIpOyAvLyBvd25lcgogICAgICB9IGVs
c2UgaWYoYSA9PSAzNyl7CiAgICAgICAgcHV0X29wYXF1ZSg2LCAib3RoZXIiKTsgLy8gb3duZXJf
Z3JvdXAKICAgICAgfSBlbHNlIGlmKGEgPT0gNDEpewogICAgICAgIHB1dDMyKDEpOyAvLyByYXdk
ZXYgbWFqb3IKICAgICAgICBwdXQzMigxKTsgLy8gcmF3ZGV2IG1pbm9yCiAgICAgIH0gZWxzZSBp
ZihhID09IDQ1KXsKICAgICAgICBwdXQ2NCg0MDk2KjEwKTsgLy8gc3BhY2UgdXNlZAogICAgICB9
IGVsc2UgaWYoYSA9PSA0Nyl7CiAgICAgICAgcHV0NjQoMCk7IC8vIHRpbWUgYWNjZXNzIHNlY29u
ZHMKICAgICAgICBwdXQzMigwKTsgLy8gbnNlY29uZHMKICAgICAgfSBlbHNlIGlmKGEgPT0gNTEp
ewogICAgICAgIHB1dDY0KDApOyAvLyB0aW1lIGRlbHRhIHNlY29uZHMKICAgICAgICBwdXQzMigw
KTsgLy8gbnNlY29uZHMKICAgICAgfSBlbHNlIGlmKGEgPT0gNTIpewogICAgICAgIHB1dDY0KDAp
OyAvLyB0aW1lIG1ldGFkYXRhIHNlY29uZHMKICAgICAgICBwdXQzMigwKTsgLy8gbnNlY29uZHMK
ICAgICAgfSBlbHNlIGlmKGEgPT0gNTMpewogICAgICAgIHB1dDY0KDApOyAvLyB0aW1lIG1vZGlm
eSBzZWNvbmRzCiAgICAgICAgcHV0MzIoMCk7IC8vIG5zZWNvbmRzCiAgICAgIH0gZWxzZSBpZihh
ID09IDU1KXsKICAgICAgICBwdXQ2NCgwKTsgLy8gbW91bnRlZF9vbl9maWxlaWQgPz8/CiAgICAg
IH0gZWxzZSBpZihhID09IDYyKXsKICAgICAgICAvLyBmc19sYXlvdXRfdHlwZXMKICAgICAgICBw
dXQzMigxKTsKICAgICAgICBwdXQzMigxKTsgLy8gTEFZT1VUNF9ORlNWNF8xX0ZJTEVTCiAgICAg
IH0gZWxzZSBpZihhID09IDc1KXsKICAgICAgICAvLyBGQVRUUjRfU1VQUEFUVFJfRVhDTENSRUFU
CiAgICAgICAgcHV0MzIoMik7IC8vIGJpdG1hcCBsZW5ndGgKICAgICAgICBwdXQzMigweGZmZmZm
ZmZmKTsKICAgICAgICBwdXQzMigweGZmZmZmZmZmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBw
cmludGYoInVua25vd24gcmVxdWVzdGVkIGF0dHIgJWRcbiIsIGEpOwogICAgICAgIHB1dDY0KDAp
OyAvLyBYWFgKICAgICAgfQogICAgfQogIH0KICAqKGludCopKG9idWYrbGVuaSkgPSBodG9ubChv
aSAtIGxlbmkgLSA0KTsKfQoKdm9pZApwYXJzZV9vcF9nZXRhdHRyKCkKewogIGludCBiaXR3b3Jk
cyA9IHBhcnNlMzIoKTsKICBpbnQgd29yZHNbNjRdOwogIGZvcihpbnQgaSA9IDA7IGkgPCBiaXR3
b3JkczsgaSsrKQogICAgd29yZHNbaV0gPSBwYXJzZTMyKCk7CiAgcHV0MzIoMCk7IC8vIE9LCiAg
cHV0X2ZhdHRyNChiaXR3b3Jkcywgd29yZHMsIGN1cnJlbnRfZmgpOwp9Cgp2b2lkCnBhcnNlX29w
X3B1dGZoKCkKewogIGNoYXIgYnVmWzY0XTsKICBpbnQgbiA9IHBhcnNlX29wYXF1ZShidWYpOyAv
LyBmaAogIGlmKG4gIT0gNCl7CiAgICBwcmludGYoIm9wX3B1dGZoIGZoIHNpemUgJWQsIG5vdCA0
XG4iLCBuKTsKICAgIGV4aXQoMSk7CiAgfQogIGludCBmaCA9ICooaW50KilidWY7CiAgY3VycmVu
dF9maCA9IGZoOwogIHB1dDMyKDApOyAvLyBPSwp9Cgp2b2lkCnBhcnNlX29wX2FjY2VzcygpCnsK
ICBpbnQgbWFzayA9IHBhcnNlMzIoKTsgLy8gbWFzayBvZiByaWdodHMgdG8gcXVlcnkKICBwdXQz
MigwKTsgLy8gT0sKICBwdXQzMigweDNmKTsgLy8gc3VwcG9ydGVkID0gYWxsIHJpZ2h0cwogIHB1
dDMyKDB4M2YpOyAvLyBhY2Nlc3MgPSBhbGwgcmlnaHRzCn0KCnZvaWQKcGFyc2Vfb3BfbG9va3Vw
KCkKewogIGNoYXIgbmFtZVsyNTZdOwogIGludCBuID0gcGFyc2Vfb3BhcXVlKG5hbWUpOwogIG5h
bWVbbj49MD9uOjBdID0gJ1wwJzsKICBwcmludGYoImxvb2t1cCAlc1xuIiwgbmFtZSk7CiAgcHV0
MzIoMCk7IC8vIE9LCiAgY3VycmVudF9maCA9IG5hbWUyZmgobmFtZSk7Cn0KCnZvaWQKcGFyc2Vf
b3BfcmVhZGRpcigpCnsKICBsb25nIGxvbmcgY29va2llID0gcGFyc2U2NCgpOwogIGxvbmcgbG9u
ZyB2ZXJmID0gcGFyc2U2NCgpOyAvLyBjb29raWUgdmVyaWZpZXIKICBwYXJzZTMyKCk7IC8vIGRp
cmNvdW50CiAgcGFyc2UzMigpOyAvLyBtYXhjb3VudAogIC8vIGF0dHJfcmVxdWVzdAogIGludCBi
aXR3b3JkcyA9IHBhcnNlMzIoKTsKICBpbnQgd29yZHNbMzJdOwogIGZvcihpbnQgaSA9IDA7IGkg
PCBiaXR3b3JkczsgaSsrKQogICAgd29yZHNbaV0gPSBwYXJzZTMyKCk7CgogIHB1dDMyKDApOyAv
LyBPSwogIHB1dDY0KHZlcmYpOyAvLyBjb29raWV2ZXJmCiAgY2hhciAqbmFtZXNbXSA9IHsgInoi
LCAienp6IiB9OwogIGZvcihpbnQgaSA9IDA7IGkgPCAyOyBpKyspewogICAgcHV0MzIoMSk7IC8v
ICpuZXh0ZW50cnkKICAgIHB1dDY0KG5leHRfY29va2llKyspOyAvLyBjb29raWUKICAgIHB1dF9v
cGFxdWUoMywgbmFtZXNbaV0pOyAvLyBuYW1lCiAgICBwdXRfZmF0dHI0KGJpdHdvcmRzLCB3b3Jk
cywgbmFtZTJmaChuYW1lc1tpXSkpOwogIH0KCiAgcHV0MzIoMCk7IC8vICpuZXh0ZW50cnkKCiAg
cHV0MzIoMSk7IC8vIGVvZgp9Cgp2b2lkCnBhcnNlX29wX29wZW4oKQp7CiAgY2hhciBuYW1lWzI1
Nl07CiAgbmFtZVswXSA9IDA7CiAgcGFyc2UzMigpOyAvLyBzZXFpZAogIHBhcnNlMzIoKTsgLy8g
c2hhcmVfYWNjZXNzCiAgcGFyc2UzMigpOyAvLyBzaGFyZV9kZW55CiAgcGFyc2U2NCgpOyAvLyBv
d25lciBjbGllbnQgaWQKICBwYXJzZV9vcGFxdWUoMCk7IC8vIG93bmVyIG93bmVyCiAgLy8gb3Bl
bmZsYWc0CiAgaW50IG9wZW50eXBlID0gcGFyc2UzMigpOwogIGlmKG9wZW50eXBlID09IDEpewog
ICAgLy8gT1BFTjRfQ1JFQVRFCiAgICBpbnQgbW9kZSA9IHBhcnNlMzIoKTsgLy8gY3JlYXRlaG93
NAogICAgaWYobW9kZSA9PSAwKXsKICAgICAgLy8gVU5DSEVDS0VENAogICAgICAvLyBmYXR0cjQg
Y3JlYXRlYXR0cnMKICAgICAgaW50IGJpdHdvcmRzID0gcGFyc2UzMigpOwogICAgICBpbnQgd29y
ZHNbMzJdOwogICAgICBmb3IoaW50IGkgPSAwOyBpIDwgYml0d29yZHM7IGkrKykKICAgICAgICB3
b3Jkc1tpXSA9IHBhcnNlMzIoKTsKICAgICAgcGFyc2Vfb3BhcXVlKDApOyAvLyBhdHRybGlzdDQK
ICAgIH0gZWxzZSB7CiAgICAgIHByaW50ZigiT1BFTjRfQ1JFQVRFIHVua25vd24gbW9kZSAlZFxu
IiwgbW9kZSk7CiAgICAgIGV4aXQoMSk7CiAgICB9CiAgfSBlbHNlIGlmKG9wZW50eXBlID09IDAp
ewogICAgLy8gT1BFTjRfTk9DUkVBVEUKICB9IGVsc2UgewogICAgcHJpbnRmKCJ1bmtub3duIG9w
ZW50eXBlICVkXG4iLCBvcGVudHlwZSk7CiAgICBleGl0KDEpOwogIH0KICBpbnQgb3Blbl9jbGFp
bV90eXBlID0gcGFyc2UzMigpOwogIGlmKG9wZW5fY2xhaW1fdHlwZSA9PSAwKXsKICAgIC8vIENM
QUlNX05VTEwKICAgIHBhcnNlX29wYXF1ZShuYW1lKTsgLy8gZmlsZSBuYW1lCiAgfSBlbHNlIGlm
KG9wZW5fY2xhaW1fdHlwZSA9PSAyKXsKICAgIC8vIENMQUlNX0RFTEVHQVRFX0NVUgogICAgLy8g
b3Blbl9jbGFpbV9kZWxlZ2F0ZV9jdXI0CiAgICAvLyBzdGF0ZWlkNAogICAgcGFyc2UzMigpOyAv
LyBzZXFpZAogICAgcGFyc2UzMigpOwogICAgcGFyc2UzMigpOwogICAgcGFyc2UzMigpOwogICAg
cGFyc2Vfb3BhcXVlKG5hbWUpOyAvLyBmaWxlIG5hbWUKICB9IGVsc2UgaWYob3Blbl9jbGFpbV90
eXBlID09IDQpewogICAgLy8gQ0xBSU1fRkgKICB9IGVsc2UgewogICAgcHJpbnRmKCJveSwgb3Bl
bl9jbGFpbV90eXBlICVkXG4iLCBvcGVuX2NsYWltX3R5cGUpOwogICAgZXhpdCgxKTsKICB9Cgog
IHB1dDMyKDApOyAvLyBPSwogIC8vIHN0YXRlaWQ0CiAgcHV0MzIoMSk7IC8vIHNlcWlkCiAgcHV0
MzIoMSk7IC8vIG90aGVyCiAgcHV0MzIoMSk7CiAgcHV0MzIoMSk7CiAgLy8gY2hhbmdlX2luZm80
CiAgcHV0MzIoMSk7CiAgcHV0NjQoMCk7IC8vIGJlZm9yZQogIHB1dDY0KDApOyAvLyBhZnRlcgog
IHB1dDMyKDApOyAvLyByZmxhZ3MKICBwdXQzMigwKTsgLy8gYXR0cnNldCBiaXRtYXAgbGVuZ3Ro
CiAgLy8gb3Blbl9kZWxlZ2F0aW9uNAogIHB1dDMyKDApOyAvLyBPUEVOX0RFTEVHQVRFX05PTkUK
ICBwcmludGYoIiAgbmFtZT0lc1xuIiwgbmFtZSk7CiAgaWYobmFtZVswXSl7CiAgICBjdXJyZW50
X2ZoID0gbmFtZTJmaChuYW1lKTsKICB9IGVsc2UgewogICAgcHJpbnRmKCJvcF9vcGVuOiBubyBu
YW1lIHdpdGggd2hpY2ggdG8gc2V0IGZoXG4iKTsKICB9Cn0KCnZvaWQKcGFyc2Vfb3Bfc2V0YXR0
cigpCnsKICAvLyBzdGF0ZWlkNAogIHBhcnNlMzIoKTsgLy8gc2VxaWQKICBwYXJzZTMyKCk7IC8v
IG90aGVyCiAgcGFyc2UzMigpOyAvLyBvdGhlcgogIHBhcnNlMzIoKTsgLy8gb3RoZXIKICAvLyBm
YXR0cjQKICBpbnQgYml0d29yZHMgPSBwYXJzZTMyKCk7CiAgaW50IHdvcmRzWzY0XTsKICBmb3Io
aW50IGkgPSAwOyBpIDwgYml0d29yZHM7IGkrKykKICAgIHdvcmRzW2ldID0gcGFyc2UzMigpOwog
IHBhcnNlX29wYXF1ZSgwKTsgLy8gYXR0cmxpc3Q0CgogIHB1dDMyKDApOyAvLyBPSwogIHB1dDMy
KGJpdHdvcmRzKTsKICBmb3IoaW50IGkgPSAwOyBpIDwgYml0d29yZHM7IGkrKykKICAgIHB1dDMy
KHdvcmRzW2ldKTsKfQoKdm9pZApwYXJzZV9vcF9sYXlvdXRnZXQoKQp7CiAgcGFyc2UzMigpOyAv
LyBsb2dhX3NpZ25hbF9sYXlvdXRfYXZhaWwKICBwYXJzZTMyKCk7IC8vIGxheW91dHR5cGU0CiAg
cGFyc2UzMigpOyAvLyBsYXlvdXRpb21vZGU0CiAgcGFyc2U2NCgpOyAvLyBvZmZzZXQKICBwYXJz
ZTY0KCk7IC8vIGxlbmd0aAogIHBhcnNlNjQoKTsgLy8gbWlubGVuZ3RoCiAgcGFyc2UzMigpOyAv
LyBzdGF0ZWlkNCBzZXFpZAogIHBhcnNlMzIoKTsgLy8gc3RhdGVpZDQgb3RoZXIKICBwYXJzZTMy
KCk7IC8vIHN0YXRlaWQ0IG90aGVyCiAgcGFyc2UzMigpOyAvLyBzdGF0ZWlkNCBvdGhlcgogIHBh
cnNlMzIoKTsgLy8gY291bnQzMgogIAogIHB1dDMyKDApOyAvLyBPSwogIHB1dDMyKDApOyAvLyBy
ZXR1cm5fb25fY2xvc2UKICBwdXQzMigwKTsgLy8gc3RhdGVpZDQgc2VxaWQKICBwdXQzMigwKTsg
Ly8gc3RhdGVpZDQgb3RoZXIKICBwdXQzMigwKTsgLy8gc3RhdGVpZDQgb3RoZXIKICBwdXQzMigw
KTsgLy8gc3RhdGVpZDQgb3RoZXIKICBwdXQzMigxKTsgLy8gIyBvZiBsYXlvdXQ0CiAgcHV0NjQo
MCk7IC8vIG9mZnNldAogIHB1dDY0KDEwMDAwMDApOyAvLyBsZW5ndGgKICBwdXQzMigzKTsgLy8g
bGF5b3V0aW9tb2RlNAogIHB1dDMyKDEpOyAvLyBsYXlvdXR0eXBlNAogIHB1dF9vcGFxdWUoOCwg
Inh4eHh4eHh4Iik7IC8vIGxvY19ib2R5Cn0KCnZvaWQKcGFyc2Vfb3Bfd3JpdGUoKQp7CiAgcGFy
c2UzMigpOyAvLyBzdGF0ZWlkNAogIHBhcnNlMzIoKTsgLy8gc3RhdGVpZDQKICBwYXJzZTMyKCk7
IC8vIHN0YXRlaWQ0CiAgcGFyc2UzMigpOyAvLyBzdGF0ZWlkNAogIHBhcnNlNjQoKTsgLy8gb2Zm
c2V0CiAgcGFyc2UzMigpOyAvLyBzdGFibGVfaG93NAogIGludCBuID0gcGFyc2Vfb3BhcXVlKDAp
OyAvLyBkYXRhCgogIHB1dDMyKDApOyAvLyBPSwogIHB1dDMyKG4pOyAvLyBjb3VudAogIHB1dDMy
KDApOyAvLyBVTlNUQUJMRTQKICBwdXQ2NCgxKTsgLy8gdmVyaWZpZXIKfQoKdm9pZApwYXJzZV9v
cF9yZWFkKCkKewogIHBhcnNlMzIoKTsgLy8gc3RhdGVpZDQKICBwYXJzZTMyKCk7IC8vIHN0YXRl
aWQ0CiAgcGFyc2UzMigpOyAvLyBzdGF0ZWlkNAogIHBhcnNlMzIoKTsgLy8gc3RhdGVpZDQKICBw
YXJzZTY0KCk7IC8vIG9mZnNldAogIHBhcnNlMzIoKTsgLy8gY291bnQKCiAgcHV0MzIoMCk7IC8v
IE9LCiAgcHV0MzIoMSk7IC8vIGVvZgogIHB1dF9vcGFxdWUoNCwgImFiY2QiKTsKfQoKdm9pZApw
YXJzZV9vcF9jb21taXQoKQp7CiAgcGFyc2U2NCgpOyAvLyBvZmZzZXQKICBwYXJzZTMyKCk7IC8v
IGNvdW50CiAgcHV0MzIoMCk7IC8vIE9LCiAgcHV0NjQoMSk7IC8vIHZlcmlmaWVyNAp9Cgp2b2lk
CnBhcnNlX2NvbXBvdW5kKCkKewogIGNoYXIgdGFnWzUxMl07CiAgaW50IHRhZ2xlbiA9IHBhcnNl
X29wYXF1ZSh0YWcpOyAvLyB0YWcKICBwYXJzZTMyKCk7IC8vIG1pbm9yIHZlcnNpb24KICBpbnQg
bm9wcyA9IHBhcnNlMzIoKTsKCiAgLy8gc3RhcnQgYSBDT01QT1VORDRyZXMKICBwdXQzMigwKTsg
Ly8gbmZzc3RhdDQgPSBORlM0X09LCiAgcHV0X29wYXF1ZSh0YWdsZW4sIHRhZyk7CiAgcHV0MzIo
bm9wcyk7IC8vIGxlbmd0aCBvZiByZXNhcnJheTw+CiAgCiAgZm9yKGludCBvcGluZGV4ID0gMDsg
b3BpbmRleCA8IG5vcHMgJiYgb2kgPCBpbGVuOyBvcGluZGV4KyspewogICAgaW50IG9wID0gcGFy
c2UzMigpOwogICAgcHJpbnRmKCJvcCAlZCAjJWRcbiIsIG9wLCBvcGNvdW50c1tvcCYweGZmXSk7
CiAgICBwdXQzMihvcCk7IC8vIHJlc29wIGluIG5mc19yZXNvcDQKICAgIGlmKHN5bV9vcCA9PSBv
cCl7CiAgICAgIGlmKHN5bV9za2lwID09IDApewogICAgICAgIHN5bXN0YXJ0ID0gb2k7CnByaW50
Zigic3ltc3RhcnQgJWRcbiIsIHN5bXN0YXJ0KTsKICAgICAgfQogICAgICBzeW1fc2tpcCAtPSAx
OwogICAgfQogICAgaWYob3AgPT0gNDIpewogICAgICBwYXJzZV9vcF9leGNoYW5nZV9pZCgpOwog
ICAgfSBlbHNlIGlmKG9wID09IDQzKXsKICAgICAgcGFyc2Vfb3BfY3JlYXRlX3Nlc3Npb24oKTsK
ICAgIH0gZWxzZSBpZihvcCA9PSA1Myl7CiAgICAgIHBhcnNlX29wX3NlcXVlbmNlKCk7CiAgICB9
IGVsc2UgaWYob3AgPT0gNTgpewogICAgICBwYXJzZV9vcF9yZWNsYWltX2NvbXBsZXRlKCk7CiAg
ICB9IGVsc2UgaWYob3AgPT0gMjQpewogICAgICBwYXJzZV9vcF9wdXRyb290ZmgoKTsKICAgIH0g
ZWxzZSBpZihvcCA9PSA1Mil7CiAgICAgIHBhcnNlX29wX3NlY2luZm9fbm9fbmFtZSgpOwogICAg
fSBlbHNlIGlmKG9wID09IDQ0KXsKICAgICAgcGFyc2Vfb3BfZGVzdHJveV9zZXNzaW9uKCk7CiAg
ICB9IGVsc2UgaWYob3AgPT0gNTcpewogICAgICBwYXJzZV9vcF9kZXN0cm95X2NsaWVudGlkKCk7
CiAgICB9IGVsc2UgaWYob3AgPT0gMTApewogICAgICBwYXJzZV9vcF9nZXRmaCgpOwogICAgfSBl
bHNlIGlmKG9wID09IDkpewogICAgICBwYXJzZV9vcF9nZXRhdHRyKCk7CiAgICB9IGVsc2UgaWYo
b3AgPT0gMjIpewogICAgICBwYXJzZV9vcF9wdXRmaCgpOwogICAgfSBlbHNlIGlmKG9wID09IDMp
ewogICAgICBwYXJzZV9vcF9hY2Nlc3MoKTsKICAgIH0gZWxzZSBpZihvcCA9PSAxNSl7CiAgICAg
IHBhcnNlX29wX2xvb2t1cCgpOwogICAgfSBlbHNlIGlmKG9wID09IDI2KXsKICAgICAgcGFyc2Vf
b3BfcmVhZGRpcigpOwogICAgfSBlbHNlIGlmKG9wID09IDE4KXsKICAgICAgcGFyc2Vfb3Bfb3Bl
bigpOwogICAgfSBlbHNlIGlmKG9wID09IDM0KXsKICAgICAgcGFyc2Vfb3Bfc2V0YXR0cigpOwog
ICAgfSBlbHNlIGlmKG9wID09IDUwKXsKICAgICAgcGFyc2Vfb3BfbGF5b3V0Z2V0KCk7CiAgICB9
IGVsc2UgaWYob3AgPT0gMzgpewogICAgICBwYXJzZV9vcF93cml0ZSgpOwogICAgfSBlbHNlIGlm
KG9wID09IDI1KXsKICAgICAgcGFyc2Vfb3BfcmVhZCgpOwogICAgfSBlbHNlIGlmKG9wID09IDUp
ewogICAgICBwYXJzZV9vcF9jb21taXQoKTsKICAgIH0gZWxzZSB7CiAgICAgIHByaW50ZigidW5r
bm93biBvcCAlZFxuIiwgb3ApOwogICAgICAvLyBjYW5ub3QgY29udGludWUgdG8gdGhlIG5leHQg
b3Agc2luY2UKICAgICAgLy8gd2UgZG9uJ3Qga25vdyBob3cgbG9uZyB0aGlzIG9uZSBpcy4KICAg
ICAgYnJlYWs7CiAgICB9CiAgICBpZihzeW1zdGFydCAhPSAtMSkKICAgICAgc3ltZW5kID0gb2k7
CiAgICBvcGNvdW50c1tvcCYweGZmXSArPSAxOwogIH0KfQoKdm9pZApwYXJzZV9ycGMoKQp7CiAg
Ly8gU1VOIFJQQwogIGludCB4aWQgPSBwYXJzZTMyKCk7CiAgcGFyc2UzMigpOyAvLyBtdHlwZT1D
QUxMCiAgcGFyc2UzMigpOyAvLyBycGMgdmVyc2lvbgogIHBhcnNlMzIoKTsgLy8gcHJvZyMKICBw
YXJzZTMyKCk7IC8vIHByb2cgdmVycwogIGludCBwcm9jID0gcGFyc2UzMigpOwogIHBhcnNlMzIo
KTsgLy8gY3JlZCB0eXBlCiAgcGFyc2Vfb3BhcXVlKDApOyAvLyBjcmVkCiAgcGFyc2UzMigpOyAv
LyB2ZXJmIHR5cGUKICBwYXJzZV9vcGFxdWUoMCk7IC8vIHZlcmYKCiAgcHV0MzIoeGlkKTsKICBw
dXQzMigxKTsgLy8gUkVQTFkKICBwdXQzMigwKTsgLy8gTVNHX0FDQ0VQVEVECiAgcHV0MzIoMCk7
IC8vIG9wYXF1ZV9hdXRoIGZsYXZvciA9IEFVVEhfTlVMTAogIHB1dDMyKDApOyAvLyBvcGFxdWVf
YXV0aCBsZW5ndGgKICBwdXQzMigwKTsgLy8gU1VDQ0VTUwoKICBpZihwcm9jID09IDApewogICAg
cGFyc2Vfbm9wKCk7CiAgfSBlbHNlIGlmKHByb2MgPT0gMSl7CiAgICBwYXJzZV9jb21wb3VuZCgp
OwogIH0gZWxzZSB7CiAgICBwcmludGYoInVua25vd24gcnBjIHByb2MgJWRcbiIsIHByb2MpOwog
IH0KfQoKaW50Cm1haW4oKXsKICBzZXRsaW5lYnVmKHN0ZG91dCk7CiAgc3RydWN0IHJsaW1pdCBy
OwogIHIucmxpbV9jdXIgPSByLnJsaW1fbWF4ID0gMDsKICBzZXRybGltaXQoUkxJTUlUX0NPUkUs
ICZyKTsKCiAgaW50IHMgPSBzb2NrZXQoQUZfSU5FVCwgU09DS19TVFJFQU0sIDApOwogIHN0cnVj
dCBzb2NrYWRkcl9pbiBzaW47CiAgbWVtc2V0KCZzaW4sIDAsIHNpemVvZihzaW4pKTsKICBzaW4u
c2luX2ZhbWlseSA9IEFGX0lORVQ7CiAgc2luLnNpbl9wb3J0ID0gaHRvbnMoMjA0OSk7CiAgaW50
IHllcyA9IDE7CiAgc2V0c29ja29wdChzLCBTT0xfU09DS0VULCBTT19SRVVTRUFERFIsICZ5ZXMs
IHNpemVvZih5ZXMpKTsKICBpZihiaW5kKHMsIChzdHJ1Y3Qgc29ja2FkZHIgKikmc2luLCBzaXpl
b2Yoc2luKSkgPCAwKXsKICAgIHBlcnJvcigiYmluZCIpOyBleGl0KDEpOwogIH0KICBsaXN0ZW4o
cywgMTApOwoKCiAgaW50IHBpZDEgPSBmb3JrKCk7CiAgaWYocGlkMSA9PSAwKXsKICAgIGNsb3Nl
KHMpOwogICAgaWYoc3lzdGVtKCJlY2hvIC1uIG1vdW50OiA7IG1vdW50IC1vIG5vbG9jayAxMjcu
MC4wLjE6L3RtcCAvbW50IikgPT0gMCl7CiAgICB9CiAgICBleGl0KDApOwogIH0KCiAgaW50IHBp
ZDIgPSBmb3JrKCk7CiAgaWYocGlkMiA9PSAwKXsKCiAgICBzb2NrbGVuX3Qgc2lubGVuID0gc2l6
ZW9mKHNpbik7CiAgICBwcmludGYoImNhbGxpbmcgYWNjZXB0XG4iKTsKICAgIGludCBzMSA9IGFj
Y2VwdChzLCAoc3RydWN0IHNvY2thZGRyICopICZzaW4sICZzaW5sZW4pOwogICAgcHJpbnRmKCJh
Y2NlcHQgcmV0dXJuZWQgJWRcbiIsIHMxKTsKICAgIGlmKHMxIDwgMCkgeyBwZXJyb3IoImFjY2Vw
dCIpOyBleGl0KDEpOyB9CiAgICBjbG9zZShzKTsKICAKICAgIHdoaWxlKDEpewogICAgICBpZihy
ZWFkbihzMSwgJmlsZW4sIDQpIDwgMCkgYnJlYWs7CiAgICAgIGlsZW4gPSBudG9obChpbGVuKTsK
ICAgICAgaWxlbiAmPSAweDdmZmZmZmZmOwogICAgICBpZihyZWFkbihzMSwgaWJ1ZiwgaWxlbikg
PCAwKSBicmVhazsKICAgICAgb2kgPSBpaSA9IDA7CiAgICAgIHB1dDMyKDApOyAvLyBwbGFjZS1o
b2xkZXIgZm9yIGxlbmd0aAogICAgICBwYXJzZV9ycGMoKTsKICAgICAgKihpbnQqKShvYnVmKzAp
ID0gaHRvbmwoKG9pIC0gNCkgfCAweDgwMDAwMDAwKTsKICAgICAgaWYoYWFpID4gTkFBKXsKICAg
ICAgICBwcmludGYoIm9vcHMgYWFpICVkIE5BQSAlZFxuIiwgYWFpLCBOQUEpOwogICAgICAgIGV4
aXQoMSk7CiAgICAgIH0KICAgICAgaWYoc3ltc3RhcnQgIT0gLTEpewogICAgICAgIGZvcihpbnQg
aSA9IHN5bXN0YXJ0OyBpIDwgb2kgJiYgaSA8IHN5bWVuZCAmJiBhYWkgPCBOQUE7IGkgKz0gOCkK
ICAgICAgICAgICoodW5zaWduZWQgbG9uZyBsb25nICopKG9idWYgKyBpKSBePSBhYVthYWkrK107
CiAgICAgICAgc3ltc3RhcnQgPSAtMTsKICAgICAgfQogICAgICBpZih3cml0ZShzMSwgb2J1Ziwg
b2kpPD0wKSBwZXJyb3IoIndyaXRlIik7CiAgICB9CiAgICBleGl0KDEpOwogIH0KICBjbG9zZShz
KTsKICBzbGVlcCgxNSk7Cn0K
--=-=-=--
