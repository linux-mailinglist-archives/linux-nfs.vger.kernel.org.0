Return-Path: <linux-nfs-owner@vger.kernel.org>
X-Original-To: lists+linux-nfs@lfdr.de
Delivered-To: lists+linux-nfs@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id A9E4C45509B
	for <lists+linux-nfs@lfdr.de>; Wed, 17 Nov 2021 23:34:33 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S235033AbhKQWha (ORCPT <rfc822;lists+linux-nfs@lfdr.de>);
        Wed, 17 Nov 2021 17:37:30 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:55260 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S241281AbhKQWh3 (ORCPT
        <rfc822;linux-nfs@vger.kernel.org>); Wed, 17 Nov 2021 17:37:29 -0500
Received: from mail-lf1-x132.google.com (mail-lf1-x132.google.com [IPv6:2a00:1450:4864:20::132])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id AF88CC061570
        for <linux-nfs@vger.kernel.org>; Wed, 17 Nov 2021 14:34:29 -0800 (PST)
Received: by mail-lf1-x132.google.com with SMTP id t26so15695794lfk.9
        for <linux-nfs@vger.kernel.org>; Wed, 17 Nov 2021 14:34:29 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=vastdata.com; s=google;
        h=mime-version:from:date:message-id:subject:to;
        bh=rCGmULVjgfMESMgLCHWYe1/vqNfO+N2a22aZ2YfhGok=;
        b=QfxZWOPNPI6iPdHZV159mxBjl+4zsip6H9HMjUQ+n8vpunBzh3IEnH0YQVoe7K8hEf
         QZIGT/qEcUB/Z++J/b116XPkNjhBvnX9jhR4OoMgES+99xs8bdZrPl5be+q5GYSXk/m7
         jQ5uReM3yUEkW50KWXRDuMxDgC/OWIK4/i/crCErNZ9c9QlsgR+GlZBupC3FVJA9cUfK
         BgUBM++iVUFkt4dEWcITjvRD3AOy3qQB2d7kw0gYtaBYPc/CdNwXCQZB5kcBCP+fDDyn
         NU2+Od6FlVVVYeovASgJU28EbvYCa4wLSQ07qAxQJKkuEeWKKRI2vK/sald9Rr5pA0JB
         D0HQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:mime-version:from:date:message-id:subject:to;
        bh=rCGmULVjgfMESMgLCHWYe1/vqNfO+N2a22aZ2YfhGok=;
        b=T8Mfz71ix09CjqNmBHnwyAyesbp88ujSg0aaxadHLSYXRg7p6aV4zi/6+uODtmYGlt
         F2h+L0qD3XFuUpo0mCxYRoo7sxLfqaYcJJoQWZdb5NZZouAl1CayuGBAXFY7hC6PkuoS
         Qeq5tN+XEU53R6bwL5U6dwk9AfhyU08f/KVF+Z2/piK5+wCLiWuHcTA3nnUclhfpvHrA
         KmCp+VjgGlTIstI/Wozif6XtINdMdqEn2iyclm+Ccg53C6SLJ3hkxyOu9hea48Dnx3ML
         BjUidcxS53Jc+e0R+z2SIsW1iezeVUqJ+Viwif0MyI2v5A/KMf60SqMiYitA3Yh0G4y2
         5rBg==
X-Gm-Message-State: AOAM530TuzhQUdQ141b6aomGJaQ4O/Z1Ij9W1tHom2HSfCTH0HgQfhOd
        lIeFh4SyA4VXPq8ngkeyyIytXK6yBg8HFqwGcDE/6ChIaux8EQ==
X-Google-Smtp-Source: ABdhPJz98FRCqrVTVedX/LLzx5omwT51kDJb8CkcT3n2jQFUbCyonxONDDKxqbaAfCupSa9mNpYN1eYepZqIqUOGnLk=
X-Received: by 2002:a2e:888f:: with SMTP id k15mr11562565lji.53.1637188468020;
 Wed, 17 Nov 2021 14:34:28 -0800 (PST)
MIME-Version: 1.0
From:   Volodymyr Khomenko <volodymyr@vastdata.com>
Date:   Thu, 18 Nov 2021 00:34:16 +0200
Message-ID: <CANkgweusOQRSvTtCRLPmGHO3YkTkfbvdtMCwg6RPv6Q54G4EHA@mail.gmail.com>
Subject: pynfs: fixed gssapi usage (RPCGSS) + GSS* tests for nfs4.0 server test
To:     linux-nfs@vger.kernel.org,
        "J. Bruce Fields" <bfields@fieldses.org>,
        Ilan Steinberg <ilan@vastdata.com>
Content-Type: multipart/mixed; boundary="0000000000001144f705d103a584"
Precedence: bulk
List-ID: <linux-nfs.vger.kernel.org>
X-Mailing-List: linux-nfs@vger.kernel.org

--0000000000001144f705d103a584
Content-Type: text/plain; charset="UTF-8"

Hi linux-nfs,

Please review attached patches for gssapi-related code of nfs4.0
server test (pynfs).
This is a continuation of previous work to make GSS tests work
correctly with the recent gssapi python library (using python3).

$ nfs4.0/testserver.py server.fqdn:/export gss noGSS8 --security=krb5
...
Command line asked for 8 of 673 tests
Of those: 3 Skipped, 0 Failed, 0 Warned, 5 Passed

$ nfs4.0/testserver.py server.fqdn:/export GSS8 --security=krb5
...
Command line asked for 1 of 673 tests
Of those: 0 Skipped, 0 Failed, 0 Warned, 1 Passed

$ nfs4.0/testserver.py server.fqdn:/export gss noGSS8 --security=krb5i
...
Command line asked for 8 of 673 tests
Of those: 1 Skipped, 0 Failed, 0 Warned, 7 Passed

Thanks,
Volodymyr Khomenko.

--0000000000001144f705d103a584
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0002-Fixed-gss-flag-for-nfs4.0-server-test-GSS-tests.patch"
Content-Disposition: attachment; 
	filename="0002-Fixed-gss-flag-for-nfs4.0-server-test-GSS-tests.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_kw43bk0w1>
X-Attachment-Id: f_kw43bk0w1

RnJvbSBmZTZlOWZlZTRiZDE5NzllMmUwMmQ5ZjQ2ZDc2ZGFjZTkwYjU5MDljIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBWb2xvZHlteXIgS2hvbWVua28gPHZvbG9keW15ckB2YXN0ZGF0
YS5jb20+CkRhdGU6IFRodSwgMTggTm92IDIwMjEgMDA6MDY6MDIgKzAyMDAKU3ViamVjdDogW1BB
VENIIDIvMl0gRml4ZWQgZ3NzIGZsYWcgZm9yIG5mczQuMCBzZXJ2ZXIgdGVzdCAoR1NTKiB0ZXN0
cykKCi0gRml4ZWQgc2NvcGUvdmlzaWJpbGl0eSBpc3N1ZSBvZiBjYXVnaHQgZXhjZXB0aW9uICdl
JyBmb3IgdHJ5L2V4Y2VwdAotIEFkZGVkIE9TRXJyb3IgZXhjZXB0aW9uIGFzIGEgdmFsaWQgdXNl
LWNhc2UgZm9yIHRlc3RCYWRHc3NTZXFudW0gKGFrYSBHU1MxKToKICBzZXJ2ZXIgbWF5IGNsb3Nl
IFRDUCBjb25uZWN0aW9uIGFzIGEgcG9zc2libGUgcmVhY3Rpb24gZm9yIGJhZCBHU1Mgc2VxX251
bQotIEZpeGVkIHB5dGhvbjMgaXNzdWVzIGZvciBjb25jYXRlbmF0aW5nIGJ5dGVzICsgc3RyaW5n
CgpTaWduZWQtb2ZmLWJ5OiBWb2xvZHlteXIgS2hvbWVua28gPHZvbG9keW15ckB2YXN0ZGF0YS5j
b20+Ci0tLQogbmZzNC4wL3NlcnZlcnRlc3RzL3N0X2dzcy5weSB8IDgyICsrKysrKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDUwIGluc2VydGlvbnMoKyks
IDMyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL25mczQuMC9zZXJ2ZXJ0ZXN0cy9zdF9nc3Mu
cHkgYi9uZnM0LjAvc2VydmVydGVzdHMvc3RfZ3NzLnB5CmluZGV4IGUxMGU4NDkuLmY2NTFlNTcg
MTAwNjQ0Ci0tLSBhL25mczQuMC9zZXJ2ZXJ0ZXN0cy9zdF9nc3MucHkKKysrIGIvbmZzNC4wL3Nl
cnZlcnRlc3RzL3N0X2dzcy5weQpAQCAtNzgsNiArNzgsOCBAQCBkZWYgdGVzdEJhZEdzc1NlcW51
bSh0LCBlbnYpOgogICAgICAgICAgICAgcmVzID0gYy5jb21wb3VuZChbb3AucHV0cm9vdGZoKCld
KQogICAgICAgICBleGNlcHQgdGltZW91dDoKICAgICAgICAgICAgIHN1Y2Nlc3MgPSBUcnVlCisg
ICAgICAgIGV4Y2VwdCBPU0Vycm9yOgorICAgICAgICAgICAgc3VjY2VzcyA9IFRydWUKICAgICAg
ICAgaWYgbm90IHN1Y2Nlc3M6CiAgICAgICAgICAgICB0LmZhaWwoIlVzaW5nIG9sZCBnc3Nfc2Vx
X251bSAlaSBzaG91bGQgY2F1c2UgZHJvcHBlZCByZXBseSIgJQogICAgICAgICAgICAgICAgICAg
IChvcmlnICsgMSkpCkBAIC0xMDYsMTcgKzEwOCwxOSBAQCBkZWYgdGVzdEluY29uc2lzdGVudEdz
c1NlcW51bSh0LCBlbnYpOgogCiAgICAgdHJ5OgogICAgICAgICBjLnNlY3VyaXR5LnNlY3VyZV9k
YXRhID0gYmFkX3NlY3VyZV9kYXRhCisgICAgICAgIGVyciA9IE5vbmUKICAgICAgICAgdHJ5Ogog
ICAgICAgICAgICAgcmVzID0gYy5jb21wb3VuZChbb3AucHV0cm9vdGZoKCldKQotICAgICAgICAg
ICAgZSA9ICJvcGVyYXRpb24gZXJyb25lb3VzbHkgc3VjZWVkaW5nIgorICAgICAgICAgICAgZXJy
ID0gIm9wZXJhdGlvbiBlcnJvbmVvdXNseSBzdWNlZWRpbmciCiAgICAgICAgIGV4Y2VwdCBycGMu
UlBDQWNjZXB0RXJyb3IgYXMgZToKICAgICAgICAgICAgIGlmIGUuc3RhdCA9PSBycGMuR0FSQkFH
RV9BUkdTOgogICAgICAgICAgICAgICAgICMgVGhpcyBpcyBjb3JyZWN0IHJlc3BvbnNlCiAgICAg
ICAgICAgICAgICAgcmV0dXJuCisgICAgICAgICAgICBlcnIgPSBzdHIoZSkKICAgICAgICAgZXhj
ZXB0IEV4Y2VwdGlvbiBhcyBlOgotICAgICAgICAgICAgcGFzcworICAgICAgICAgICAgZXJyID0g
c3RyKGUpCiAgICAgICAgIHQuZmFpbCgiVXNpbmcgaW5jb25zaXN0ZW50IGdzc19zZXFfbnVtcyBp
biBoZWFkZXIgYW5kIGJvZHkgb2YgbWVzc2FnZSAiCi0gICAgICAgICAgICAgICAic2hvdWxkIHJl
dHVybiBHQVJCQUdFX0FSR1MsIGluc3RlYWQgZ290ICVzIiAlIGUpCisgICAgICAgICAgICAgICAi
c2hvdWxkIHJldHVybiBHQVJCQUdFX0FSR1MsIGluc3RlYWQgZ290ICVzIiAlIGVycikKICAgICBm
aW5hbGx5OgogICAgICAgICBjLnNlY3VyaXR5LnNlY3VyZV9kYXRhID0gb3JpZ19mdW5jdAogCkBA
IC0xMzEsMjEgKzEzNSwyMyBAQCBkZWYgdGVzdEJhZFZlcmZDaGVja3N1bSh0LCBlbnYpOgogICAg
IG9yaWdfZnVuY3QgPSBjLnNlY3VyaXR5Lm1ha2VfdmVyZgogICAgIGRlZiBiYWRfbWFrZV92ZXJm
KGRhdGEpOgogICAgICAgICAjIE1lc3MgdXAgdmVyaWZpZXIKLSAgICAgICAgcmV0dXJuIG9yaWdf
ZnVuY3QoZGF0YSArICJ4IikKKyAgICAgICAgcmV0dXJuIG9yaWdfZnVuY3QoZGF0YSArIGIieCIp
CiAKICAgICB0cnk6CiAgICAgICAgIGMuc2VjdXJpdHkubWFrZV92ZXJmID0gYmFkX21ha2VfdmVy
ZgorICAgICAgICBlcnIgPSBOb25lCiAgICAgICAgIHRyeToKICAgICAgICAgICAgIHJlcyA9IGMu
Y29tcG91bmQoW29wLnB1dHJvb3RmaCgpXSkKLSAgICAgICAgICAgIGUgPSAicGVyYXRpb24gZXJy
b25lb3VzbHkgc3VjZWVkaW5nIgorICAgICAgICAgICAgZXJyID0gInBlcmF0aW9uIGVycm9uZW91
c2x5IHN1Y2VlZGluZyIKICAgICAgICAgZXhjZXB0IHJwYy5SUENEZW5pZWRFcnJvciBhcyBlOgog
ICAgICAgICAgICAgaWYgZS5zdGF0ID09IHJwYy5BVVRIX0VSUk9SIGFuZCBlLmFzdGF0ID09IHJw
Yy5SUENTRUNfR1NTX0NSRURQUk9CTEVNOgotICAgICAgICAgICAgICAgICMgVGhpcyBpcyBjb3Jy
ZWN0IHJlc3BvbnNlCi0gICAgICAgICAgICAgICAgcmV0dXJuCisgICAgICAgICAgICAgICAjIFRo
aXMgaXMgY29ycmVjdCByZXNwb25zZQorICAgICAgICAgICAgICAgcmV0dXJuCisgICAgICAgICAg
ICBlcnIgPSBzdHIoZSkKICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgotICAgICAgICAg
ICAgcGFzcworICAgICAgICAgICAgZXJyID0gc3RyKGUpCiAgICAgICAgIHQuZmFpbCgiVXNpbmcg
YmFkIHZlcmlmaWVyIGNoZWNrc3VtIGluIGhlYWRlciAiCi0gICAgICAgICAgICAgICAic2hvdWxk
IHJldHVybiBSUENTRUNfR1NTX0NSRURQUk9CTEVNLCBpbnN0ZWFkIGdvdCAlcyIgJSBlKQorICAg
ICAgICAgICAgICAgInNob3VsZCByZXR1cm4gUlBDU0VDX0dTU19DUkVEUFJPQkxFTSwgaW5zdGVh
ZCBnb3QgJXMiICUgZXJyKQogICAgIGZpbmFsbHk6CiAgICAgICAgIGMuc2VjdXJpdHkubWFrZV92
ZXJmID0gb3JpZ19mdW5jdAogCkBAIC0xNjQsMjQgKzE3MCwyNiBAQCBkZWYgdGVzdEJhZERhdGFD
aGVja3N1bSh0LCBlbnYpOgogICAgICAgICAjIE1lc3MgdXAgY2hlY2tzdW0KICAgICAgICAgZGF0
YSA9IG9yaWdfZnVuY3QoZGF0YSwgc2VxbnVtKQogICAgICAgICBpZiBkYXRhWy00XToKLSAgICAg
ICAgICAgIHRhaWwgPSBjaHIoMCkgKyBkYXRhWy0zOl0KKyAgICAgICAgICAgIHRhaWwgPSBiJ1x4
MDAnICsgZGF0YVstMzpdCiAgICAgICAgIGVsc2U6Ci0gICAgICAgICAgICB0YWlsID0gY2hyKDEp
ICsgZGF0YVstMzpdCisgICAgICAgICAgICB0YWlsID0gYidceDAxJyArIGRhdGFbLTM6XQogICAg
ICAgICByZXR1cm4gZGF0YVs6LTRdICsgdGFpbAogCiAgICAgdHJ5OgogICAgICAgICBjLnNlY3Vy
aXR5LnNlY3VyZV9kYXRhID0gYmFkX3NlY3VyZV9kYXRhCisgICAgICAgIGVyciA9IE5vbmUKICAg
ICAgICAgdHJ5OgogICAgICAgICAgICAgcmVzID0gYy5jb21wb3VuZChbb3AucHV0cm9vdGZoKCld
KQotICAgICAgICAgICAgZSA9ICJvcGVyYXRpb24gZXJyb25lb3VzbHkgc3VjZWVkaW5nIgorICAg
ICAgICAgICAgZXJyID0gIm9wZXJhdGlvbiBlcnJvbmVvdXNseSBzdWNlZWRpbmciCiAgICAgICAg
IGV4Y2VwdCBycGMuUlBDQWNjZXB0RXJyb3IgYXMgZToKICAgICAgICAgICAgIGlmIGUuc3RhdCA9
PSBycGMuR0FSQkFHRV9BUkdTOgogICAgICAgICAgICAgICAgICMgVGhpcyBpcyBjb3JyZWN0IHJl
c3BvbnNlCiAgICAgICAgICAgICAgICAgcmV0dXJuCisgICAgICAgICAgICBlcnIgPSBzdHIoZSkK
ICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgotICAgICAgICAgICAgcGFzcworICAgICAg
ICAgICAgZXJyID0gc3RyKGUpCiAgICAgICAgIHQuZmFpbCgiVXNpbmcgYmFkIGRhdGEgY2hlY2tz
dW0gZm9yIGJvZHkgb2YgbWVzc2FnZSAiCi0gICAgICAgICAgICAgICAic2hvdWxkIHJldHVybiBH
QVJCQUdFX0FSR1MsIGluc3RlYWQgZ290ICVzIiAlIGUpCisgICAgICAgICAgICAgICAic2hvdWxk
IHJldHVybiBHQVJCQUdFX0FSR1MsIGluc3RlYWQgZ290ICVzIiAlIGVycikKICAgICBmaW5hbGx5
OgogICAgICAgICBjLnNlY3VyaXR5LnNlY3VyZV9kYXRhID0gb3JpZ19mdW5jdAogCkBAIC0yMTEs
MTkgKzIxOSwyMiBAQCBkZWYgdGVzdEJhZFZlcnNpb24odCwgZW52KToKICAgICAgICAgYy5zZWN1
cml0eSA9IEJhZEdzc0hlYWRlcihvcmlnLCBiYWRfdmVyc2lvbikKICAgICAgICAgYmFkX3ZlcnNp
b25zID0gWzAsIDIsIDMsIDEwMjRdCiAgICAgICAgIGZvciB2ZXJzaW9uIGluIGJhZF92ZXJzaW9u
czoKKyAgICAgICAgICAgIGVyciA9IE5vbmUKICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAg
ICAgICByZXMgPSBjLmNvbXBvdW5kKFtvcC5wdXRyb290ZmgoKV0pCi0gICAgICAgICAgICAgICAg
ZSA9ICJvcGVyYXRpb24gZXJyb25lb3VzbHkgc3VjZWVkaW5nIgorICAgICAgICAgICAgICAgIGVy
ciA9ICJvcGVyYXRpb24gZXJyb25lb3VzbHkgc3VjZWVkaW5nIgogICAgICAgICAgICAgZXhjZXB0
IHJwYy5SUENEZW5pZWRFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgIGlmIGUuc3RhdCA9PSBy
cGMuQVVUSF9FUlJPUiBhbmQgZS5hc3RhdCA9PSBycGMuQVVUSF9CQURDUkVEOgogICAgICAgICAg
ICAgICAgICAgICAjIFRoaXMgaXMgY29ycmVjdCByZXNwb25zZQotICAgICAgICAgICAgICAgICAg
ICBlID0gTm9uZQorICAgICAgICAgICAgICAgICAgICBwYXNzCisgICAgICAgICAgICAgICAgZWxz
ZToKKyAgICAgICAgICAgICAgICAgICAgZXJyID0gc3RyKGUpCiAgICAgICAgICAgICBleGNlcHQg
RXhjZXB0aW9uIGFzIGU6Ci0gICAgICAgICAgICAgICAgcGFzcwotICAgICAgICAgICAgaWYgZSBp
cyBub3QgTm9uZToKKyAgICAgICAgICAgICAgICBlcnIgPSBzdHIoZSkKKyAgICAgICAgICAgIGlm
IGVyciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICB0LmZhaWwoIlVzaW5nIGJhZCBnc3Mg
dmVyc2lvbiBudW1iZXIgJWkgIgogICAgICAgICAgICAgICAgICAgICAgICAic2hvdWxkIHJldHVy
biBBVVRIX0JBRENSRUQsIGluc3RlYWQgZ290ICVzIiAlCi0gICAgICAgICAgICAgICAgICAgICAg
ICh2ZXJzaW9uLCBlKSkKKyAgICAgICAgICAgICAgICAgICAgICAgKHZlcnNpb24sIGVycikpCiAg
ICAgZmluYWxseToKICAgICAgICAgYy5zZWN1cml0eSA9IG9yaWcKIApAQCAtMjM4LDE3ICsyNDks
MTggQEAgZGVmIHRlc3RIaWdoU2VxTnVtKHQsIGVudik6CiAgICAgb3JpZ19zZXEgPSBjLnNlY3Vy
aXR5Lmdzc19zZXFfbnVtCiAgICAgdHJ5OgogICAgICAgICBjLnNlY3VyaXR5Lmdzc19zZXFfbnVt
ID0gZ3NzLk1BWFNFUSArIDEKKyAgICAgICAgZXJyID0gTm9uZQogICAgICAgICB0cnk6CiAgICAg
ICAgICAgICByZXMgPSBjLmNvbXBvdW5kKFtvcC5wdXRyb290ZmgoKV0pCi0gICAgICAgICAgICBl
ID0gIm9wZXJhdGlvbiBlcnJvbmVvdXNseSBzdWNlZWRpbmciCisgICAgICAgICAgICBlcnIgPSAi
b3BlcmF0aW9uIGVycm9uZW91c2x5IHN1Y2VlZGluZyIKICAgICAgICAgZXhjZXB0IHJwYy5SUENE
ZW5pZWRFcnJvciBhcyBlOgogICAgICAgICAgICAgaWYgZS5zdGF0ID09IHJwYy5BVVRIX0VSUk9S
IGFuZCBlLmFzdGF0ID09IHJwYy5SUENTRUNfR1NTX0NUWFBST0JMRU06CiAgICAgICAgICAgICAg
ICAgIyBUaGlzIGlzIGNvcnJlY3QgcmVzcG9uc2UKICAgICAgICAgICAgICAgICByZXR1cm4KICAg
ICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgotICAgICAgICAgICAgcGFzcworICAgICAgICAg
ICAgZXJyID0gc3RyKGUpCiAgICAgICAgIHQuZmFpbCgiVXNpbmcgZ3NzX3NlcV9udW0gb3ZlciBN
QVhTRVEgIgotICAgICAgICAgICAgICAgInNob3VsZCByZXR1cm4gUlBDU0VDX0dTU19DVFhQUk9C
TEVNLCBpbnN0ZWFkIGdvdCAlcyIgJSBlKQorICAgICAgICAgICAgICAgInNob3VsZCByZXR1cm4g
UlBDU0VDX0dTU19DVFhQUk9CTEVNLCBpbnN0ZWFkIGdvdCAlcyIgJSBlcnIpCiAgICAgZmluYWxs
eToKICAgICAgICAgYy5zZWN1cml0eS5nc3Nfc2VxX251bSA9IG9yaWdfc2VxCiAKQEAgLTI3NCwy
MSArMjg2LDI0IEBAIGRlZiB0ZXN0QmFkUHJvY2VkdXJlKHQsIGVudik6CiAKICAgICB0cnk6CiAg
ICAgICAgIGMuc2VjdXJpdHkgPSBCYWRHc3NIZWFkZXIob3JpZywgYmFkX3Byb2MpCisgICAgICAg
IGVyciA9IE5vbmUKICAgICAgICAgYmFkX3Byb2NzcyA9IFs0LCA1LCAxMDI0XQogICAgICAgICBm
b3IgcHJvYyBpbiBiYWRfcHJvY3NzOgogICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAg
IHJlcyA9IGMuY29tcG91bmQoW29wLnB1dHJvb3RmaCgpXSkKLSAgICAgICAgICAgICAgICBlID0g
Im9wZXJhdGlvbiBlcnJvbmVvdXNseSBzdWNlZWRpbmciCisgICAgICAgICAgICAgICAgZXJyID0g
Im9wZXJhdGlvbiBlcnJvbmVvdXNseSBzdWNlZWRpbmciCiAgICAgICAgICAgICBleGNlcHQgcnBj
LlJQQ0RlbmllZEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICAgaWYgZS5zdGF0ID09IHJwYy5B
VVRIX0VSUk9SIGFuZCBlLmFzdGF0ID09IHJwYy5BVVRIX0JBRENSRUQ6CiAgICAgICAgICAgICAg
ICAgICAgICMgVGhpcyBpcyBjb3JyZWN0IHJlc3BvbnNlCi0gICAgICAgICAgICAgICAgICAgIGUg
PSBOb25lCisgICAgICAgICAgICAgICAgICAgIHBhc3MKKyAgICAgICAgICAgICAgICBlbHNlOgor
ICAgICAgICAgICAgICAgICAgICBlcnIgPSBzdHIoZSkKICAgICAgICAgICAgIGV4Y2VwdCBFeGNl
cHRpb24gYXMgZToKLSAgICAgICAgICAgICAgICBwYXNzCi0gICAgICAgICAgICBpZiBlIGlzIG5v
dCBOb25lOgorICAgICAgICAgICAgICAgIGVyciA9IHN0cihlKQorICAgICAgICAgICAgaWYgZXJy
IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgIHQuZmFpbCgiVXNpbmcgYmFkIGdzcyBwcm9j
ZWR1cmUgbnVtYmVyICVpICIKICAgICAgICAgICAgICAgICAgICAgICAgInNob3VsZCByZXR1cm4g
QVVUSF9CQURDUkVELCBpbnN0ZWFkIGdvdCAlcyIgJQotICAgICAgICAgICAgICAgICAgICAgICAo
cHJvYywgZSkpCisgICAgICAgICAgICAgICAgICAgICAgIChwcm9jLCBlcnIpKQogICAgIGZpbmFs
bHk6CiAgICAgICAgIGMuc2VjdXJpdHkgPSBvcmlnCiAKQEAgLTMxNiwyMCArMzMxLDIzIEBAIGRl
ZiB0ZXN0QmFkU2VydmljZSh0LCBlbnYpOgogCiAgICAgdHJ5OgogICAgICAgICBjLnNlY3VyaXR5
ID0gQmFkR3NzSGVhZGVyKG9yaWcsIGJhZF9zZXJ2aWNlKQorICAgICAgICBlcnIgPSBOb25lCiAg
ICAgICAgIGJhZF9zZXJ2aWNlcyA9IFswLCA0LCA1LCAxMDI0XQogICAgICAgICBmb3Igc2Vydmlj
ZSBpbiBiYWRfc2VydmljZXM6CiAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgcmVz
ID0gYy5jb21wb3VuZChbb3AucHV0cm9vdGZoKCldKQotICAgICAgICAgICAgICAgIGUgPSAib3Bl
cmF0aW9uIGVycm9uZW91c2x5IHN1Y2VlZGluZyIKKyAgICAgICAgICAgICAgICBlcnIgPSAib3Bl
cmF0aW9uIGVycm9uZW91c2x5IHN1Y2VlZGluZyIKICAgICAgICAgICAgIGV4Y2VwdCBycGMuUlBD
RGVuaWVkRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgICBpZiBlLnN0YXQgPT0gcnBjLkFVVEhf
RVJST1IgYW5kIGUuYXN0YXQgPT0gcnBjLkFVVEhfQkFEQ1JFRDoKICAgICAgICAgICAgICAgICAg
ICAgIyBUaGlzIGlzIGNvcnJlY3QgcmVzcG9uc2UKLSAgICAgICAgICAgICAgICAgICAgZSA9IE5v
bmUKKyAgICAgICAgICAgICAgICAgICAgcGFzcworICAgICAgICAgICAgICAgIGVsc2U6CisgICAg
ICAgICAgICAgICAgICAgIGVyciA9IHN0cihlKQogICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlv
biBhcyBlOgotICAgICAgICAgICAgICAgIHBhc3MKLSAgICAgICAgICAgIGlmIGUgaXMgbm90IE5v
bmU6CisgICAgICAgICAgICAgICAgZXJyID0gc3RyKGUpCisgICAgICAgICAgICBpZiBlcnIgaXMg
bm90IE5vbmU6CiAgICAgICAgICAgICAgICAgdC5mYWlsKCJVc2luZyBiYWQgZ3NzIHNlcnZpY2Ug
bnVtYmVyICVpICIKICAgICAgICAgICAgICAgICAgICAgICAgInNob3VsZCByZXR1cm4gQVVUSF9C
QURDUkVELCBpbnN0ZWFkIGdvdCAlcyIgJQotICAgICAgICAgICAgICAgICAgICAgICAoc2Vydmlj
ZSwgZSkpCisgICAgICAgICAgICAgICAgICAgICAgIChzZXJ2aWNlLCBlcnIpKQogICAgIGZpbmFs
bHk6CiAgICAgICAgIGMuc2VjdXJpdHkgPSBvcmlnCi0tIAoyLjI0LjEKCg==
--0000000000001144f705d103a584
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0001-Fixed-gssapi-usage-RPCGSS-for-nfs4.0-server-test.patch"
Content-Disposition: attachment; 
	filename="0001-Fixed-gssapi-usage-RPCGSS-for-nfs4.0-server-test.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_kw43bjzh0>
X-Attachment-Id: f_kw43bjzh0

RnJvbSAzZjk0ZTlhYTgxMWNmZmYwMzNhOGQ1NDM4Yjc2NzljZTBmYTU1YjczIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBWb2xvZHlteXIgS2hvbWVua28gPHZvbG9keW15ckB2YXN0ZGF0
YS5jb20+CkRhdGU6IFdlZCwgMTcgTm92IDIwMjEgMjM6NTg6MjAgKzAyMDAKU3ViamVjdDogW1BB
VENIIDEvMl0gRml4ZWQgZ3NzYXBpIHVzYWdlIChSUENHU1MpIGZvciBuZnM0LjAgc2VydmVyIHRl
c3QKCmdzc2FwaSBsaWJyYXJ5IHVzZWQgaW4gdGhlIGNvZGUgaGFzIGJlZW4gY2hhbmdlZCBhbmQg
Y3VycmVudCBjb2RlIGlzIG5vdApjb21wYXRpYmxlIHdpdGggQVBJIG9mIG5ldyBsaWJyYXJ5IHZl
cnNpb24uICBGaXhlZCB0aGUgY29kZQp0byB3b3JrIHdpdGggcmVjZW50IGdzc2FwaSAodGVzdGVk
IHdpdGggMS42LjIpLgpUZXN0ZWQgd2l0aCBrcmI1LCBrcmI1aSBhbmQga3JiNXAgc2VjdXJpdHks
IGxpa2UgdGhpczoKbmZzNC4wL3Rlc3RzZXJ2ZXIucHkgc2VydmVyLmZxZG46L2V4cG9ydCBnc3Mg
bm9HU1M4IC0tc2VjdXJpdHk9a3JiNQpOb3RlIC0gR1NTOCBpcyBrbm93biB0byBjYXVzZSB0aGUg
cHJvYmxlbXMgZm9yIG90aGVyIHRlc3RzIHRoYXQgcnVuIGFmdGVyIGl0LApob3dldmVyIGl0J3Mg
c2FmZSB0byBydW4gaXQgYWxvbmUuCgpTaWduZWQtb2ZmLWJ5OiBWb2xvZHlteXIgS2hvbWVua28g
PHZvbG9keW15ckB2YXN0ZGF0YS5jb20+Ci0tLQogbmZzNC4wL2xpYi9ycGMvcnBjc2VjL3NlY19h
dXRoX2dzcy5weSB8IDExNiArKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5n
ZWQsIDQ1IGluc2VydGlvbnMoKyksIDcxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL25mczQu
MC9saWIvcnBjL3JwY3NlYy9zZWNfYXV0aF9nc3MucHkgYi9uZnM0LjAvbGliL3JwYy9ycGNzZWMv
c2VjX2F1dGhfZ3NzLnB5CmluZGV4IDFiNWViOTMuLjY1NzdmY2YgMTAwNjQ0Ci0tLSBhL25mczQu
MC9saWIvcnBjL3JwY3NlYy9zZWNfYXV0aF9nc3MucHkKKysrIGIvbmZzNC4wL2xpYi9ycGMvcnBj
c2VjL3NlY19hdXRoX2dzcy5weQpAQCAtMSw4ICsxLDggQEAKIGZyb20gLmJhc2UgaW1wb3J0IFNl
Y0ZsYXZvciwgU2VjRXJyb3IKIGZyb20gcnBjLnJwY19jb25zdCBpbXBvcnQgUlBDU0VDX0dTUwog
ZnJvbSBycGMucnBjX3R5cGUgaW1wb3J0IG9wYXF1ZV9hdXRoCi1mcm9tIGdzc19jb25zdCBpbXBv
cnQgKgotaW1wb3J0IGdzc19wYWNrCitmcm9tIC5nc3NfY29uc3QgaW1wb3J0ICoKK2Zyb20gLiBp
bXBvcnQgZ3NzX3BhY2sKIGltcG9ydCBnc3NfdHlwZQogaW1wb3J0IGdzc2FwaQogaW1wb3J0IHRo
cmVhZGluZwpAQCAtMTI1LDUwICsxMjUsNDEgQEAgY2xhc3MgU2VjQXV0aEdzcyhTZWNGbGF2b3Ip
OgogICAgIGRlZiBpbml0aWFsaXplKHNlbGYsIGNsaWVudCk6ICMgTm90ZSB0aGlzIGlzIG5vdCB0
aHJlYWQgc2FmZQogICAgICAgICAiIiJTZXQgc2VxX251bSwgaW5pdCwgaGFuZGxlLCBhbmQgY29u
dGV4dCIiIgogICAgICAgICBzZWxmLmdzc19zZXFfbnVtID0gMAotICAgICAgICBkID0gZ3NzYXBp
LmltcG9ydE5hbWUoIm5mc0AlcyIgJSBjbGllbnQucmVtb3RlaG9zdCkKLSAgICAgICAgaWYgZFsn
bWFqb3InXSAhPSBnc3NhcGkuR1NTX1NfQ09NUExFVEU6Ci0gICAgICAgICAgICByYWlzZSBTZWNF
cnJvcigiZ3NzYXBpLmltcG9ydE5hbWUgcmV0dXJuZWQ6ICVzIiAlIFwKLSAgICAgICAgICAgICAg
ICAgIHNob3dfbWFqb3IoZFsnbWFqb3InXSkpCi0gICAgICAgIG5hbWUgPSBkWyduYW1lJ10KLSAg
ICAgICAgIyBXZSBuZWVkIHRvIHNlbmQgTlVMTFBST0NzIHdpdGggdG9rZW4gZnJvbSBpbml0U2Vj
Q29udGV4dAotICAgICAgICBnb29kX21ham9yID0gW2dzc2FwaS5HU1NfU19DT01QTEVURSwgZ3Nz
YXBpLkdTU19TX0NPTlRJTlVFX05FRURFRF0KKyAgICAgICAgbmFtZSA9IGdzc2FwaS5OYW1lKCJu
ZnNAJXMiICUgY2xpZW50LnJlbW90ZWhvc3QsIGdzc2FwaS5OYW1lVHlwZS5ob3N0YmFzZWRfc2Vy
dmljZSkKKyAgICAgICAgIyBXZSBuZWVkIHRvIHNlbmQgTlVMTFBST0NzIHdpdGggdG9rZW4gZnJv
bSBTZWN1cml0eUNvbnRleHQKKyAgICAgICAgZ29vZF9tYWpvciA9IFtHU1NfU19DT01QTEVURSwg
R1NTX1NfQ09OVElOVUVfTkVFREVEXQogICAgICAgICBzZWxmLmluaXQgPSAxCi0gICAgICAgIHJl
cGx5X3Rva2VuID0gTm9uZQotICAgICAgICByZXBseV9tYWpvciA9ICcnCi0gICAgICAgIGNvbnRl
eHQgPSBOb25lCisgICAgICAgIGlucHV0X3Rva2VuID0gTm9uZQorCisgICAgICAgICMgUkZDMjIw
MyA1LjIuMi4gIENvbnRleHQgQ3JlYXRpb24gUmVxdWVzdHMKKyAgICAgICAgIyBXaGVuIEdTU19J
bml0X3NlY19jb250ZXh0KCkgaXMgY2FsbGVkLCB0aGUgcGFyYW1ldGVycworICAgICAgICAjIHJl
cGxheV9kZXRfcmVxX2ZsYWcgYW5kIHNlcXVlbmNlX3JlcV9mbGFnIG11c3QgYmUgdHVybmVkIG9m
Zi4KKworICAgICAgICAjIE5vdGUgLSBieSBkZWZhdWx0LCBvdXRfb2Zfc2VxdWVuY2VfZGV0ZWN0
aW9uIGZsYWcgKHNlcXVlbmNlX3JlcV9mbGFnKSBpcyB1c2VkIGJ5IGdzc2FwaS5pbml0X3NlY19j
b250ZXh0KCkKKyAgICAgICAgIyBhbmQgd2UgaGF2ZSAnQW4gZXhwZWN0ZWQgcGVyLW1lc3NhZ2Ug
dG9rZW4gd2FzIG5vdCByZWNlaXZlZCcgZXJyb3IgKEdTU19TX0dBUF9UT0tFTikuCisgICAgICAg
ICMgVG8gcHJldmVudCB0aGlzLCB3ZSBuZWVkIHRvIHVzZSBkZWZhdWx0IGZsYWdzIHdpdGhvdXQg
b3V0X29mX3NlcXVlbmNlX2RldGVjdGlvbiBiaXQuCisgICAgICAgIGZsYWdzID0gZ3NzYXBpLklu
dEVudW1GbGFnU2V0KGdzc2FwaS5SZXF1aXJlbWVudEZsYWcsIFtnc3NhcGkuUmVxdWlyZW1lbnRG
bGFnLm11dHVhbF9hdXRoZW50aWNhdGlvbl0pCisgICAgICAgIGNvbnRleHQgPSBnc3NhcGkuU2Vj
dXJpdHlDb250ZXh0KG5hbWU9bmFtZSwgZmxhZ3M9ZmxhZ3MpCiAgICAgICAgIHdoaWxlIFRydWU6
Ci0gICAgICAgICAgICBkID0gZ3NzYXBpLmluaXRTZWNDb250ZXh0KG5hbWUsIGNvbnRleHQsIHJl
cGx5X3Rva2VuKQotICAgICAgICAgICAgbWFqb3IgPSBkWydtYWpvciddCi0gICAgICAgICAgICBj
b250ZXh0ID0gZFsnY29udGV4dCddCi0gICAgICAgICAgICBpZiBtYWpvciBub3QgaW4gZ29vZF9t
YWpvcjoKLSAgICAgICAgICAgICAgICByYWlzZSBTZWNFcnJvcigiZ3NzYXBpLmluaXRTZWNDb250
ZXh0IHJldHVybmVkOiAlcyIgJSBcCi0gICAgICAgICAgICAgICAgICAgICAgc2hvd19tYWpvciht
YWpvcikpCi0gICAgICAgICAgICBpZiAobWFqb3IgPT0gZ3NzYXBpLkdTU19TX0NPTlRJTlVFX05F
RURFRCkgYW5kIFwKLSAgICAgICAgICAgICAgICAgICAocmVwbHlfbWFqb3IgPT0gZ3NzYXBpLkdT
U19TX0NPTVBMRVRFKToKLSAgICAgICAgICAgICAgICByYWlzZSBTZWNFcnJvcigiVW5leHBlY3Rl
ZCBHU1NfU19DT01QTEVURSBmcm9tIHNlcnZlciIpCi0gICAgICAgICAgICB0b2tlbiA9IGRbJ3Rv
a2VuJ10KLSAgICAgICAgICAgIGlmIHJlcGx5X21ham9yICE9IGdzc2FwaS5HU1NfU19DT01QTEVU
RToKLSAgICAgICAgICAgICAgICAjIEZSRUQgLSBzZWMgNS4yLjIgb2YgUkZDIDIyMDMgbWVudGlv
bnMgcG9zc2liaWxpdHkgdGhhdAotICAgICAgICAgICAgICAgICMgbm8gdG9rZW4gaXMgcmV0dXJu
ZWQuICBCdXQgdGhlbiBob3cgZ2V0IGhhbmRsZT8KLSAgICAgICAgICAgICAgICBwID0gc2VsZi5n
ZXRwYWNrZXIoKQotICAgICAgICAgICAgICAgIHAucmVzZXQoKQotICAgICAgICAgICAgICAgIHAu
cGFja19vcGFxdWUodG9rZW4pCi0gICAgICAgICAgICAgICAgZGF0YSA9IHAuZ2V0X2J1ZmZlcigp
Ci0gICAgICAgICAgICAgICAgcmVwbHkgPSBjbGllbnQuY2FsbCgwLCBkYXRhKQotICAgICAgICAg
ICAgICAgIHVwID0gc2VsZi5nZXR1bnBhY2tlcigpCi0gICAgICAgICAgICAgICAgdXAucmVzZXQo
cmVwbHkpCi0gICAgICAgICAgICAgICAgcmVzID0gdXAudW5wYWNrX3JwY19nc3NfaW5pdF9yZXMo
KQotICAgICAgICAgICAgICAgIHVwLmRvbmUoKQotICAgICAgICAgICAgICAgIHJlcGx5X21ham9y
ID0gcmVzLmdzc19tYWpvcgotICAgICAgICAgICAgICAgIGlmIHJlcGx5X21ham9yIG5vdCBpbiBn
b29kX21ham9yOgotICAgICAgICAgICAgICAgICAgICByYWlzZSBTZWNFcnJvcigiU2VydmVyIHJl
dHVybmVkOiAlcyIgJSBcCi0gICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dfbWFqb3IocmVw
bHlfbWFqb3IpKQotICAgICAgICAgICAgICAgIHNlbGYuaW5pdCA9IDIKLSAgICAgICAgICAgICAg
ICByZXBseV90b2tlbiA9IHJlcy5nc3NfdG9rZW4KLSAgICAgICAgICAgIGlmIG1ham9yID09IGdz
c2FwaS5HU1NfU19DT01QTEVURToKLSAgICAgICAgICAgICAgICBpZiByZXBseV9tYWpvciAhPSBn
c3NhcGkuR1NTX1NfQ09NUExFVEU6Ci0gICAgICAgICAgICAgICAgICAgIHJhaXNlIFNlY0Vycm9y
KCJVbmV4cGVjdGVkIENPTVBMRVRFIGZyb20gY2xpZW50IikKKyAgICAgICAgICAgICMgbm90ZSAt
IGdzc2FwaSB3aWxsIHJhaXNlIGFuIGV4Y2VwdGlvbiBoZXJlIGF1dG9tYXRpY2FsbHkgaW4gY2Fz
ZSBvZiBmYWlsdXJlCisgICAgICAgICAgICBvdXRwdXRfdG9rZW4gPSBjb250ZXh0LnN0ZXAoaW5w
dXRfdG9rZW4pCisgICAgICAgICAgICBpZiBjb250ZXh0LmNvbXBsZXRlOgogICAgICAgICAgICAg
ICAgIGJyZWFrCisgICAgICAgICAgICBwID0gc2VsZi5nZXRwYWNrZXIoKQorICAgICAgICAgICAg
cC5yZXNldCgpCisgICAgICAgICAgICBwLnBhY2tfb3BhcXVlKG91dHB1dF90b2tlbikKKyAgICAg
ICAgICAgIGRhdGEgPSBwLmdldF9idWZmZXIoKQorICAgICAgICAgICAgcmVwbHkgPSBjbGllbnQu
Y2FsbCgwLCBkYXRhKQorICAgICAgICAgICAgdXAgPSBzZWxmLmdldHVucGFja2VyKCkKKyAgICAg
ICAgICAgIHVwLnJlc2V0KHJlcGx5KQorICAgICAgICAgICAgcmVzID0gdXAudW5wYWNrX3JwY19n
c3NfaW5pdF9yZXMoKQorICAgICAgICAgICAgdXAuZG9uZSgpCisgICAgICAgICAgICByZXBseV9t
YWpvciA9IHJlcy5nc3NfbWFqb3IKKyAgICAgICAgICAgIGlmIHJlcGx5X21ham9yIG5vdCBpbiBn
b29kX21ham9yOgorICAgICAgICAgICAgICAgIHJhaXNlIFNlY0Vycm9yKCJTZXJ2ZXIgcmV0dXJu
ZWQ6ICVzIiAlIFwKKyAgICAgICAgICAgICAgICAgICAgc2hvd19tYWpvcihyZXBseV9tYWpvcikp
CisgICAgICAgICAgICBzZWxmLmluaXQgPSAyCisgICAgICAgICAgICBpbnB1dF90b2tlbiA9IHJl
cy5nc3NfdG9rZW4KICAgICAgICAgc2VsZi5nc3NfY29udGV4dCA9IGNvbnRleHQKICAgICAgICAg
c2VsZi5nc3NfaGFuZGxlID0gcmVzLmhhbmRsZQogICAgICAgICBzZWxmLmluaXQgPSAwCkBAIC0x
NzYsNyArMTY3LDcgQEAgY2xhc3MgU2VjQXV0aEdzcyhTZWNGbGF2b3IpOgogICAgIGRlZiBtYWtl
X2NyZWQoc2VsZik6CiAgICAgICAgICIiIkNyZWRlbnRpYWwgc2VudCB3aXRoIGVhY2ggUlBDIGNh
bGwiIiIKICAgICAgICAgaWYgc2VsZi5pbml0ID09IDE6ICMgZmlyc3QgY2FsbCBpbiBjb250ZXh0
IGNyZWF0aW9uCi0gICAgICAgICAgICBjcmVkID0gc2VsZi5fbWFrZV9jcmVkX2dzcygnJywgcnBj
X2dzc19zdmNfbm9uZSwgUlBDU0VDX0dTU19JTklUKQorICAgICAgICAgICAgY3JlZCA9IHNlbGYu
X21ha2VfY3JlZF9nc3MoYicnLCBycGNfZ3NzX3N2Y19ub25lLCBSUENTRUNfR1NTX0lOSVQpCiAg
ICAgICAgIGVsaWYgc2VsZi5pbml0ID4gMTogIyBzdWJzZXF1ZW50IGNhbGxzIGluIGNvbnRleHQg
Y3JlYXRpb24KICAgICAgICAgICAgIGNyZWQgPSBzZWxmLl9tYWtlX2NyZWRfZ3NzKCcnLCBycGNf
Z3NzX3N2Y19ub25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJQQ1NFQ19H
U1NfQ09OVElOVUVfSU5JVCkKQEAgLTIzNywxMiArMjI4LDggQEAgY2xhc3MgU2VjQXV0aEdzcyhT
ZWNGbGF2b3IpOgogICAgICAgICBpZiBzZWxmLmluaXQ6CiAgICAgICAgICAgICByZXR1cm4gc2Vs
Zi5fbm9uZQogICAgICAgICBlbHNlOgotICAgICAgICAgICAgZCA9IGdzc2FwaS5nZXRNSUMoc2Vs
Zi5nc3NfY29udGV4dCwgZGF0YSkKLSAgICAgICAgICAgIG1ham9yID0gZFsnbWFqb3InXQotICAg
ICAgICAgICAgaWYgbWFqb3IgIT0gZ3NzYXBpLkdTU19TX0NPTVBMRVRFOgotICAgICAgICAgICAg
ICAgIHJhaXNlIFNlY0Vycm9yKCJnc3NhcGkuZ2V0TUlDIHJldHVybmVkOiAlcyIgJSBcCi0gICAg
ICAgICAgICAgICAgICAgICAgc2hvd19tYWpvcihtYWpvcikpCi0gICAgICAgICAgICByZXR1cm4g
b3BhcXVlX2F1dGgoUlBDU0VDX0dTUywgZFsndG9rZW4nXSkKKyAgICAgICAgICAgIHRva2VuID0g
c2VsZi5nc3NfY29udGV4dC5nZXRfc2lnbmF0dXJlKGRhdGEpCisgICAgICAgICAgICByZXR1cm4g
b3BhcXVlX2F1dGgoUlBDU0VDX0dTUywgdG9rZW4pCiAgICAgICAgIAogICAgIGRlZiBfbWFrZV9j
cmVkX2dzcyhzZWxmLCBoYW5kbGUsIHNlcnZpY2UsIGdzc19wcm9jPVJQQ1NFQ19HU1NfREFUQSwg
c2VxPTApOgogICAgICAgICBkYXRhID0gZ3NzX3R5cGUucnBjX2dzc19jcmVkX3ZlcnNfMV90KGdz
c19wcm9jLCBzZXEsIHNlcnZpY2UsIGhhbmRsZSkKQEAgLTI2NCwxMyArMjUxLDEwIEBAIGNsYXNz
IFNlY0F1dGhHc3MoU2VjRmxhdm9yKToKICAgICAgICAgICAgIHAucmVzZXQoKQogICAgICAgICAg
ICAgcC5wYWNrX3VpbnQoZ3NzX2NyZWQuc2VxX251bSkKICAgICAgICAgICAgIGRhdGEgPSBwLmdl
dF9idWZmZXIoKSArIGRhdGEKLSAgICAgICAgICAgIGQgPSBnc3NhcGkuZ2V0TUlDKHNlbGYuZ3Nz
X2NvbnRleHQsIGRhdGEpCi0gICAgICAgICAgICBpZiBkWydtYWpvciddICE9IGdzc2FwaS5HU1Nf
U19DT01QTEVURToKLSAgICAgICAgICAgICAgICByYWlzZSBTZWNFcnJvcigiZ3NzYXBpLmdldE1J
QyByZXR1cm5lZDogJXMiICUgXAotICAgICAgICAgICAgICAgICAgICAgIHNob3dfbWFqb3IoZFsn
bWFqb3InXSkpCisgICAgICAgICAgICB0b2tlbiA9IHNlbGYuZ3NzX2NvbnRleHQuZ2V0X3NpZ25h
dHVyZShkYXRhKQogICAgICAgICAgICAgcC5yZXNldCgpCiAgICAgICAgICAgICBwLnBhY2tfb3Bh
cXVlKGRhdGEpCi0gICAgICAgICAgICBwLnBhY2tfb3BhcXVlKGRbJ3Rva2VuJ10pCisgICAgICAg
ICAgICBwLnBhY2tfb3BhcXVlKHRva2VuKQogICAgICAgICAgICAgZGF0YSA9IHAuZ2V0X2J1ZmZl
cigpCiAgICAgICAgIGVsaWYgZ3NzX2NyZWQuc2VydmljZSA9PSBycGNfZ3NzX3N2Y19wcml2YWN5
OgogICAgICAgICAgICAgIyBkYXRhID0gb3BhcXVlW3dyYXAoW2dzc19zZXFfbnVtK2RhdGFdKV0K
QEAgLTI3OCwxMiArMjYyLDkgQEAgY2xhc3MgU2VjQXV0aEdzcyhTZWNGbGF2b3IpOgogICAgICAg
ICAgICAgcC5yZXNldCgpCiAgICAgICAgICAgICBwLnBhY2tfdWludChnc3NfY3JlZC5zZXFfbnVt
KQogICAgICAgICAgICAgZGF0YSA9IHAuZ2V0X2J1ZmZlcigpICsgZGF0YQotICAgICAgICAgICAg
ZCA9IGdzc2FwaS53cmFwKHNlbGYuZ3NzX2NvbnRleHQsIGRhdGEpCi0gICAgICAgICAgICBpZiBk
WydtYWpvciddICE9IGdzc2FwaS5HU1NfU19DT01QTEVURToKLSAgICAgICAgICAgICAgICByYWlz
ZSBTZWNFcnJvcigiZ3NzYXBpLndyYXAgcmV0dXJuZWQ6ICVzIiAlIFwKLSAgICAgICAgICAgICAg
ICAgICAgICBzaG93X21ham9yKGRbJ21ham9yJ10pKQorICAgICAgICAgICAgd3JhcF9kYXRhID0g
c2VsZi5nc3NfY29udGV4dC53cmFwKGRhdGEsIGVuY3J5cHQ9VHJ1ZSkKICAgICAgICAgICAgIHAu
cmVzZXQoKQotICAgICAgICAgICAgcC5wYWNrX29wYXF1ZShkWydtc2cnXSkKKyAgICAgICAgICAg
IHAucGFja19vcGFxdWUod3JhcF9kYXRhLm1lc3NhZ2UpCiAgICAgICAgICAgICBkYXRhID0gcC5n
ZXRfYnVmZmVyKCkKICAgICAgICAgZWxzZToKICAgICAgICAgICAgICMgTm90IHJlYWxseSBuZWNl
c3NhcnksIHNob3VsZCBoYXZlIGFscmVhZHkgcmFpc2VkIFhEUkVycm9yCkBAIC0zMDMsMTAgKzI4
NCw3IEBAIGNsYXNzIFNlY0F1dGhHc3MoU2VjRmxhdm9yKToKICAgICAgICAgICAgIGRhdGEgPSBw
LnVucGFja19vcGFxdWUoKQogICAgICAgICAgICAgY2hlY2tzdW0gPSBwLnVucGFja19vcGFxdWUo
KQogICAgICAgICAgICAgcC5kb25lKCkKLSAgICAgICAgICAgIGQgPSBnc3NhcGkudmVyaWZ5TUlD
KHNlbGYuZ3NzX2NvbnRleHQsIGRhdGEsIGNoZWNrc3VtKQotICAgICAgICAgICAgaWYgZFsnbWFq
b3InXSAhPSBnc3NhcGkuR1NTX1NfQ09NUExFVEU6Ci0gICAgICAgICAgICAgICAgcmFpc2UgU2Vj
RXJyb3IoImdzc2FwaS52ZXJpZnlNSUMgcmV0dXJuZWQ6ICVzIiAlIFwKLSAgICAgICAgICAgICAg
ICAgICAgICBzaG93X21ham9yKGRbJ21ham9yJ10pKQorICAgICAgICAgICAgcW9wID0gc2VsZi5n
c3NfY29udGV4dC52ZXJpZnlfc2lnbmF0dXJlKGRhdGEsIGNoZWNrc3VtKQogICAgICAgICAgICAg
cC5yZXNldChkYXRhKQogICAgICAgICAgICAgc2VxbnVtID0gcC51bnBhY2tfdWludCgpCiAgICAg
ICAgICAgICBpZiBzZXFudW0gIT0gZ3NzX2NyZWQuc2VxX251bToKQEAgLTMyMCwxMSArMjk4LDgg
QEAgY2xhc3MgU2VjQXV0aEdzcyhTZWNGbGF2b3IpOgogICAgICAgICAgICAgcC5yZXNldChkYXRh
KQogICAgICAgICAgICAgZGF0YSA9IHAudW5wYWNrX29wYXF1ZSgpCiAgICAgICAgICAgICBwLmRv
bmUoKQotICAgICAgICAgICAgZCA9IGdzc2FwaS51bndyYXAoc2VsZi5nc3NfY29udGV4dCwgZGF0
YSkKLSAgICAgICAgICAgIGlmIGRbJ21ham9yJ10gIT0gZ3NzYXBpLkdTU19TX0NPTVBMRVRFOgot
ICAgICAgICAgICAgICAgIHJhaXNlIFNlY0Vycm9yKCJnc3NhcGkudW53cmFwIHJldHVybmVkICVz
IiAlIFwKLSAgICAgICAgICAgICAgICAgICAgICBzaG93X21ham9yKGRbJ21ham9yJ10pKQotICAg
ICAgICAgICAgcC5yZXNldChkWydtc2cnXSkKKyAgICAgICAgICAgIGRhdGEsIGVuY3J5cHRlZCwg
cW9wID0gc2VsZi5nc3NfY29udGV4dC51bndyYXAoZGF0YSkKKyAgICAgICAgICAgIHAucmVzZXQo
ZGF0YSkKICAgICAgICAgICAgIHNlcW51bSA9IHAudW5wYWNrX3VpbnQoKQogICAgICAgICAgICAg
aWYgc2VxbnVtICE9IGdzc19jcmVkLnNlcV9udW06CiAgICAgICAgICAgICAgICAgcmFpc2UgU2Vj
RXJyb3IoXApAQCAtMzczLDggKzM0OCw3IEBAIGNsYXNzIFNlY0F1dGhHc3MoU2VjRmxhdm9yKToK
ICAgICAgICAgICAgIHAgPSBzZWxmLmdldHBhY2tlcigpCiAgICAgICAgICAgICBwLnJlc2V0KCkK
ICAgICAgICAgICAgIHAucGFja191aW50KGNyZWQuc2VxX251bSkKLSAgICAgICAgICAgIGQgPSBn
c3NhcGkudmVyaWZ5TUlDKHNlbGYuZ3NzX2NvbnRleHQsIHAuZ2V0X2J1ZmZlcigpLCBydmVyZi5i
b2R5KQotICAgICAgICAgICAgI3ByaW50KCJWZXJpZnkoJWkpOiIlY3JlZC5zZXFfbnVtLCBzaG93
X21ham9yKGRbJ21ham9yJ10pLCBzaG93X21pbm9yKGRbJ21pbm9yJ10pKQorICAgICAgICAgICAg
cW9wID0gc2VsZi5nc3NfY29udGV4dC52ZXJpZnlfc2lnbmF0dXJlKHAuZ2V0X2J1ZmZlcigpLCBy
dmVyZi5ib2R5KQogICAgICAgICAgICAgCiAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICBwYXNz
Ci0tIAoyLjI0LjEKCg==
--0000000000001144f705d103a584--
